<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>DBMNG Test Api</title>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">  
  
  <script type="text/javascript" src="../src/Class.js"></script>
  <script type="text/javascript" src="../src/Dbmng.js"></script> 
  <script type="text/javascript" src="../src/Api.js"></script>
  <script type="text/javascript" src="../src/Form.js"></script> 
  <script type="text/javascript" src="../src/Crud.js"></script> 
  <script type="text/javascript" src="../src/Ie9.js"></script> 
  <script type="text/javascript" src="../src/Utilities.js"></script>
  <script type="text/javascript" src="../src/themes/AbstractTheme.js"></script>
  <script type="text/javascript" src="../src/themes/BootstrapTheme.js"></script>
  <script type="text/javascript" src="../src/widgets/AbstractWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/SelectWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/NumericWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/PasswordWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/CheckboxWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/SelectNMWidget.js"></script>
</head>
<body>



  <h1>tabella: test</h1>
	<div id="test_table"></div>
  <h1>tabella: test_child</h1>
  <div id="test_child"></div>

	<div id="test_2"></div>
  <h1>tabella: test Diego</h1>
	<div id="test_diego"></div>




	<style>

/*
    #test_table form{
      display:block !important;
    }
		#test_table input{
			border: 0px;
			background-color:#FCC;
		}

		.dbmng_col_id {
			width:6em;
		}

		.dbmng_col_sex {
			width:6em;
		}

		#test_table form{
			display:inline!important;
		}
*/


/*  TEST DIEGO */

	#test_diego{
		display:table;
	}

	#test_diego form{
		display:table-row;
	}
	#test_diego .dbmng_form_row{
			display:table-cell;
	}
	#test_diego label{
		display:none;
	}
	#test_diego .dbmng_form_field_id{
		display:none;
	}

	</style>
	<script>


	test_base();
	test_bis();


function test_base(){
    // Test for Bootstrap theme
    var theme_boot=new Dbmng.BootstrapTheme();

//    jQuery('#test_2').html(theme_boot.getTable({data:[{nm:'Diego',sr:'Guid'}]}));
    
    /* ------------
       TABLE: test
    ---------------*/
    var aParam = {ui: {btn_edit: {label:'Modifica', class: 'btn-success', icon: 'fa fa-pencil'},
                    btn_edit_inline: {label:'Modifica inline', class: 'btn-success', icon: 'fa fa-pencil-square-o'},
                    btn_delete: {label:'Elimina', class: 'btn-danger', icon: 'fa fa-trash'},
                    btn_insert: {label:'Inserisci', class: 'btn-success btn-block'},
                    btn_save: {label:'Salva', class: 'btn-success btn-block'},
                    table_class: 'table-hover'},
              user_function: {inline:1, upd:1, del:1, ins:1}};

		//vecchia versione con aForm 
		/*   
    var aForm = { table_name: 'test', 
      primary_key: Array('id'), 
      fields: {
        id: {label: 'ID1', type: 'int', key: 0, nullable: false}, 
        name: {label: 'Name1', type: 'varchar',  nullable: false},
        sex: {label: 'Sex', type: 'varchar',  widget: 'select', voc_val: {'M':'Male', 'F':'Female'}},
        true_false: {label: 'E vero o è falso', type: 'integer',  widget: 'checkbox',voc_val: {'1':'è Vero!', '0':'Falso',null:'Boh'}}
      }
    };
	
		var crud=new Dbmng.Crud({aForm:aForm, aParam:aParam, theme:theme_boot,url:'/dbmng2/api/test', user:'test', password:'test'});
		crud.createTable({div_id:'#test_table'});
		*/

		//nuova versione senza aForm (lo prende online)
		var crud=new Dbmng.Crud(
			{
				aParam:aParam, theme:theme_boot,url:'/dbmng2/api/test', user:'test', password:'test',
				success:function(self){
					self.createTable({div_id:'#test_table'});
				}
			}
		);

		


		


    //var form=new Dbmng.Form({aForm:aForm, aParam:{}, theme:theme_boot});

    //var api1=new  Dbmng.Api({aForm:aForm, url:'/dbmng2/api/test', user:'test', password:'test'});
    //creaTabella(api1, '#test_table');

//     /* ------------
//        TABLE: test_child
//     ---------------*/
    var aCForm = { table_name: 'test_child', 
      primary_key: Array('id_child'), 
      fields: {
        id_child: {label: 'ID', type: 'int', key: 0, nullable: false}, 
        child_name: {label: 'Child Name', type: 'varchar',  nullable: false}
      }
    };

    var crudchild = new Dbmng.Crud({aForm:aCForm, aParam:{}, theme:theme_boot, url:'/dbmng2/api/test_child', user:'test', password:'test'});
    crudchild.createTable({div_id:'test_child'});
}



function test_bis(){

    // Test for Bootstrap theme
    var theme_boot=new Dbmng.BootstrapTheme();

    var aParam = {ui: {btn_edit: {label:'Modifica', class: 'btn-success', icon: 'fa fa-pencil'},
                    btn_edit_inline: {label:'Modifica inline', class: 'btn-success', icon: 'fa fa-pencil-square-o'},
                    btn_delete: {label:'Elimina', class: 'btn-danger', icon: 'fa fa-trash'},
                    btn_insert: {label:'Inserisci', class: 'btn-success btn-block'},
                    btn_save: {label:'Salva', class: 'btn-success btn-block'},
                    table_class: 'table-hover'},
              user_function: {inline:1, upd:1, del:1, ins:1}};

    var aForm = { table_name: 'test', 
      primary_key: Array('id'), 
      fields: {
        id: {label: 'ID1', type: 'int', key: 0, nullable: false}, 
        name: {label: 'Name1', type: 'varchar',  nullable: false},
        sex: {label: 'Sex', type: 'varchar',  widget: 'select', voc_val: {'M':'Male', 'F':'Female'}},
        true_false: {label: 'E vero o è falso', type: 'integer',  widget: 'checkbox',voc_val: {'1':'è Vero!', '0':'Falso',null:'Boh'}}
      }
    };


		var aDati=[{"name":"Diego"},{"name":"Diego2"},{"name":"Dieg32"},{"name":"Diego42"}];
		var forms=[];		

		for(var i=0; i<aDati.length; i++){
			var form=new Dbmng.Form({aForm:aForm, aParam:{}, theme:theme_boot});
			jQuery('#test_diego').append(form.createForm(aDati[i]));
			forms.push(form);
		}

		var button=theme_boot.getButton("Salva")
		jQuery('#test_diego').append(button);
		jQuery(button).click(function(){

			var aSavedData=[];
			for(var i=0; i<forms.length; i++){
				t={"mode":"insert", "body":forms[i].getValue()};
				aSavedData.push(t);
			}
			console.log(aSavedData);
			var api1=new  Dbmng.Api({aForm:aForm, url:'/dbmng2/api/test', user:'test', password:'test'});
			api1.transaction({data:aSavedData});
		})

		
		//
		
	
}


  </script>
</body>
