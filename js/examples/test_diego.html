<!DOCTYPE html>
<html>
<head>
  <title>DBMNG Test Suite</title>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.2.min.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">


  <!-- for autocomplete and file upload -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.js"></script>

  <!-- for autocomplete -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>

  <!-- for file upload -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.5.7/jquery.iframe-transport.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.5.7/jquery.fileupload.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.5.7/css/jquery.fileupload.min.css">



  <script type="text/javascript" src="../src/Class.js"></script>
  <script type="text/javascript" src="../src/Dbmng.js"></script>
  <script type="text/javascript" src="../src/Form.js"></script>
  <script type="text/javascript" src="../src/Api.js"></script>
  <script type="text/javascript" src="../src/Crud.js"></script>
  <script type="text/javascript" src="../src/Ie9.js"></script>
  <script type="text/javascript" src="../src/Utilities.js"></script>
  <script type="text/javascript" src="../src/themes/AbstractTheme.js"></script>
  <script type="text/javascript" src="../src/themes/BootstrapTheme.js"></script>
  <script type="text/javascript" src="../src/widgets/AbstractWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/SelectWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/NumericWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/PasswordWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/CheckboxWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/SelectNMWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/HiddenWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/AutocompleteWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/DateWidget.js"></script>
  <script type="text/javascript" src="../src/widgets/FileWidget.js"></script>
</head>
<body>
  <h1>Base</h1>
    <div id="test_base"></div>

  <h1>Botstrap</h1>
    <div id="test_bootstrap"></div>

  <h1>test widgets</h1>
    <div id="test_widget"></div>
    <form><div id="test_widget_select"></div></form>

  <h1>DBMNG</h1>
    <div id="test_dbmng"></div>

  <h1>DBMNG2</h1>
    <div id="test_dbmng2"></div>
  <script>

    var options={'value':'Ciao', 'label':'saluto'};

    //Test per i temi puri
    var theme=new Dbmng.AbstractTheme();
    jQuery('#test_base').html(theme.getInput(options));

    // Test for Bootstrap theme
    var theme_boot=new Dbmng.BootstrapTheme();
    jQuery('#test_bootstrap').html(theme_boot.getInput(options));

    var aForm = { table_name: 'test',
      primary_key: Array('id'),
      fields: {
        id: {label: 'ID', type: 'int', key: 0, nullable: false},
        name: {label: 'Name', type: 'varchar', 'default': 'Paperino', nullable: false},

        month: {label: 'Mounth', widget:'select', type: 'int', voc_val: {1:'January', 2:'February'}},
        montha: {label: 'Mounth auto', widget:'select', type: 'int', url: 'http://localhost/registro/api?search_citta=%QUERY', autocomplete_fieldname:'citta', autocomplete_key:'cod_istat', not_found: 'Nessuna citt√† trovata'},
        passwd: {label: 'Password', type: 'varchar', widget:'password', classes: 'aaa bbb ccc'},
        check: {label: 'Check', type: 'int', widget:'checkbox'},
        multiple: {label: 'Multiple', type: 'int', widget:'select_nm', voc_val: {1:'January', 2:'February', 3:'March', 4:'April'}},
        multiplec: {label: 'Multiple checkbox', type: 'int', widget:'select_nm', voc_val: {1:'January', 2:'February', 3:'March', 4:'April'}, out_type:'checkbox'},
        data: {label: 'Data', type: 'date', widget:'date', date_format_view:'MM d, yy'},
        file: {label: 'File', type: 'varchar', widget:'file', url:'/dbmng2/api/test/file/file', weburl_file:'/dbmng2/files/'}
      }
    };

    // parameters in aParam array act globally and not punctual.
    var aParam = { hide_label: false, html5_input: true };

    var obj = {id:2, name:'Diego', multiple: ['1','2'], month:'1'};

    var w1=new Dbmng.AbstractWidget({field:'id', aField:aForm.fields.id, theme:theme_boot});
    jQuery('#test_widget_select').append(w1.createField(obj.id));

    var w2=new Dbmng.SelectWidget({field:'month', aField:aForm.fields.month, theme:theme_boot});
    jQuery('#test_widget_select').append(w2.createField(obj.month));

    var w3=new Dbmng.AbstractWidget({field:'name', aField:aForm.fields.name, theme:theme_boot});
    jQuery('#test_widget_select').append(w3.createField(obj.name));

    var w4=new Dbmng.PasswordWidget({field:'passwd', aField:aForm.fields.passwd, theme:theme_boot});
    jQuery('#test_widget_select').append(w4.createField());

    var w5=new Dbmng.SelectNMWidget({field:'multiple', aField:aForm.fields.multiple, theme:theme_boot});
    jQuery('#test_widget_select').append(w5.createField());

    var w6=new Dbmng.SelectNMWidget({field:'multiplec', aField:aForm.fields.multiplec, theme:theme_boot});
    jQuery('#test_widget_select').append(w6.createField());

    var w7 = new Dbmng.AutocompleteWidget({field:'montha', aField:aForm.fields.montha, theme:theme_boot});
    jQuery('#test_widget_select').append(w7.createField());

    var w8 = new Dbmng.DateWidget({field:'data', aField:aForm.fields.data, theme:theme_boot});
    jQuery('#test_widget_select').append(w8.createField('2015-12-31'));

    var w9 = new Dbmng.FileWidget({field:'file', aField:aForm.fields.file, theme:theme_boot});
    jQuery('#test_widget_select').append(w9.createField('mappa-1.png'));

    jQuery('#test_widget_select').hide();

    var form=new Dbmng.Form({aForm:aForm, aParam:aParam, theme:theme_boot});

    var template="<div><h1>Pippo<div data-content='name'></div><table class='table' border='1'><tr><td data-content='passwd'></td><td data-content='month'></td><td data-content='data'></td></tr><tr style='height:300px'><td data-content='multiplec'></td><td data-content='multiple'></td></tr></table></div>";
    jQuery('#test_dbmng').append(form.createForm(obj, template));


		var aForm2 = { table_name: 'test',
      primary_key: Array('id'),
      fields: {
        id: {label: 'ID', type: 'int', key: 0, nullable: false},
        name: {label: 'Name', type: 'varchar', 'default': 'Paperino', nullable: false}
			}
    };
		var form2=new Dbmng.Form({aForm:aForm2, aParam:aParam, theme:theme_boot});
    jQuery('#test_dbmng2').append(form2.createForm(obj));

		var api=new  Dbmng.Api({aForm:aForm2, url:'/dbmng2/api/test', user:'test', password:'test'});



		function updateRecord(){
			value=form2.getValue();
			alert(value.id);
			api.update({
				key:value.id,
				data:value,
				success:function(data){
					console.log(data);
					showRecord();
				}
			});
		}


		function showRecord(){

			api.select({
				success:function(data){
					alert(JSON.stringify(data));
				}
			});

		}

/*
    api.select({success: function(data){
				console.log("Select Before");
				console.log(data.data[0]);
				api.update({key:1,data:{'id':1,'name':'Test name:'+new Date()},success:function(data){
					console.log("Updates");
					console.log(data);
			    api.select({success: function(data){
						console.log("Select After");
						console.log(data.data[0]);

					}});

				}});
		}});
*/

/*
   var theme_boot=new Dbmng.BootstrapTheme();
   var w1=new Dbmng.AbstractWidget();
   jQuery('#test_widget').append(w1.createWidget(
      {theme:theme, aField:aForm.fields.id}
    ));

   var w2=new Dbmng.NumericWidget();
    jQuery('#test_widget').append(w2.createWidget(
      {theme:theme, aField:aForm.fields.name}
    ));
  */
//     var opt2 = {label: 'Months:', value:2, voc_val: {1:'January', 2:'February'}};
//     var w3 = new Dbmng.AbstractTheme();
//     jQuery('#test_widget_select').append(w3.getLabel( opt2 ));
//     jQuery('#test_widget_select').append(w3.getSelect( opt2 ));


  </script>
</body>
