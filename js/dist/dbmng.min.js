function exeExternalFunction(a,b){var c=window[a];return"function"==typeof c?"undefined"==typeof b?c():c.apply(null,b):!1}"undefined"==typeof window.console&&(window.console={log:function(a){a=""}}),/*! DBMNG v0.0.1 
 * Date: 2015-11-02
 */
function(){var a;!function(){var b=!1,c=/xyz/.test(function(){window.postMessage("xyz")})?/\b_super\b/:/.*/;return a=function(){},a.extend=function(a){function d(){!b&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;b=!0;var f=new this;b=!1;for(var g in a)f[g]="function"==typeof a[g]&&"function"==typeof e[g]&&c.test(a[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,a[g]):a[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d},a}();var b=function(){};b.defaults={},b.Form=a.extend({init:function(a){this.aForm=a.aForm,a.aParam||(a.aParam={}),this.aParam=jQuery.extend(!0,{},b.defaults.aParam,a.aParam),a.theme?this.theme=a.theme:this.theme=b.defaults.theme,this.createWidgets()},createWidgets:function(){this.widgets={};for(var a in this.aForm.fields){var c=this.aForm.fields[a],d="";c.widget&&(d=c.widget);var e,f={field:a,aField:c,theme:this.theme,aParam:this.aParam};e="select"==d?new b.SelectWidget(f):"select_nm"==d?new b.SelectNMWidget(f):"password"==d?new b.PasswordWidget(f):"hidden"==d?new b.HiddenWidget(f):"checkbox"==d?new b.CheckboxWidget(f):"numeric"==d?new b.NumericWidget(f):"autocomplete"==d?new b.AutocompleteWidget(f):"date"==d?new b.DateWidget(f):"textarea"==d?new b.TextareaWidget(f):"file"==d?new b.FileWidget(f):new b.AbstractWidget(f),this.widgets[a]=e}},getPkField:function(){if(this.aForm.primary_key){if(this.aForm.primary_key.length>1)throw"There are more primary keys field";return this.aForm.primary_key[0]}throw"Missing primary key in aForm"},getWidget:function(a){return this.widgets[a]},getPkValue:function(){return this.widgets[this.getPkField()].getValue()},getValue:function(){var a={};for(var b in this.aForm.fields)a[b]=this.widgets[b].getValue();return a},convert2html:function(a){for(var b=[],c=0;c<a.length;c++){var d={};for(var e in this.aForm.fields)this.widgets[e].isVisible()&&!this.widgets[e].skipInTable()&&(d[e]=this.widgets[e].convert2html(a[c][e]));b.push(d)}return b},getFields:function(a){var b={};this.createWidgets();for(var c in this.aForm.fields){var d;d=a?this.widgets[c].createField(a[c]):this.widgets[c].createField(),b[c]=d}return b},isValid:function(){var a=!0,b="";for(var c in this.widgets){var d=this.widgets[c].isValid();d.ok===!1&&(a=!1,b+="Field "+this.widgets[c].field+": "+d.message+"<br/>")}return{ok:a,message:b}},createForm:function(a,b){var c,d=this.getFields(a),e=!0;if("undefined"!=typeof b&&jQuery(b).length>0&&(c=jQuery(b),e=!1),e){c=this.theme.getForm();for(var f in d)c.appendChild(d[f])}else for(var g in d){var h=c.find("[data-content="+g+"]");0===h.length?c.append(d[g]):h.append(d[g])}return c}}),b.FormInline=a.extend({init:function(a){this.aForm=a.aForm,a.aParam||(a.aParam={}),this.aParam=jQuery.extend(!0,{},b.defaults.aParam,a.aParam),a.theme?this.theme=a.theme:this.theme=b.defaults.theme,a.onChange&&(this.onChange=a.onChange),a.onChangeRow&&(this.onChangeRow=a.onChangeRow),a.addEachRow&&(this.addEachRow=a.addEachRow)},getTransaction:function(){for(var a=[],b=0;b<this.forms.length;b++){var c=this.forms[b].getPkValue(),d={mode:"update",key:c,body:this.forms[b].getValue()};a.push(d)}return a},getValue:function(){for(var a=[],b=0;b<this.forms.length;b++)a.push(this.forms[b].getValue());return a},createForm:function(a){var c=this.theme.getTable({data:[],header:[],aParam:this.aParam});this.forms=[];var d=new b.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme});for(var e in this.aForm.fields){var f=d.getWidget(e);if(f.isVisible()){var g=this.aForm.fields[e];jQuery(c).find("thead tr").append(this.theme.getTableHCell({content:g.label}))}}for(var h=0;h<a.length;h++){var i=new b.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme});this.forms.push(i);var j=i.getFields(a[h]),k=jQuery("<tr></tr>").appendTo(jQuery(c).find("tbody"));for(var l in j){var m=i.getWidget(l);if(m.isVisible()){var n=jQuery("<td></td>").appendTo(k);n.append(j[l])}else{var o=jQuery(j[l]).hide()[0];k.append(o)}m.pk_value=i.getPkValue(),m.form=i,this.onChange&&(m.onChange=this.onChange),this.onChangeRow&&(m.onFocus=this.onChangeRow)}this.addEachRow&&this.addEachRow(k,a[h])}return c}}),b.Api=a.extend({init:function(a){this.url=a.url,this.user=a.user,this.password=a.password,this.search=a.search,"/"!=this.url.slice(-1)&&(this.url=this.url+"/")},getHeaders:function(){return{Authorization:"Basic "+btoa(this.user+":"+this.password)}},select:function(a){var b=this.url;a.search&&(b+="?"+a.search),jQuery.ajax({url:b,dataType:"json",headers:this.getHeaders(),success:function(b){"function"==typeof a.success&&a.success(b)},error:function(b){"function"==typeof a.error&&a.error(b)}})},transaction:function(a){jQuery.ajax({url:this.url+"transaction",dataType:"json",method:"POST",data:JSON.stringify(a.data),headers:this.getHeaders(),success:function(b){"function"==typeof a.success&&a.success(b)},error:function(b){"function"==typeof a.error&&a.error(b)}})},insert:function(a){jQuery.ajax({url:this.url,dataType:"json",method:"POST",data:JSON.stringify(a.data),headers:this.getHeaders(),success:function(b){"function"==typeof a.success&&a.success(b)},error:function(b){"function"==typeof a.error&&a.error(b)}})},update:function(a){jQuery.ajax({url:this.url+a.key,dataType:"json",method:"POST",data:JSON.stringify(a.data),headers:this.getHeaders(),success:function(b){"function"==typeof a.success&&a.success(b)},error:function(b){"function"==typeof a.error&&a.error(b)}})},"delete":function(a){jQuery.ajax({url:this.url+a.key,dataType:"json",method:"DELETE",headers:this.getHeaders(),success:function(b){"function"==typeof a.success&&a.success(b)},error:function(b){"function"==typeof a.error&&a.error(b)}})}}),b.Crud=a.extend({init:function(a){if(this.ready=!0,this.crud_success=a.crud_success,this.form_ready=a.form_ready,this.table_ready=a.table_ready,this.prepare_cdata=a.prepare_cdata,a.aParam||(a.aParam={}),this.aParam=jQuery.extend(!0,{},b.defaults.aParam,a.aParam),a.theme?this.theme=a.theme:this.theme=b.defaults.theme,a.url?this.url=a.url:this.url="?","/"!=this.url.slice(-1)&&(this.url=this.url+"/"),this.aParam.url=this.url,a.aForm)this.aForm=a.aForm,this.form=new b.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme}),this.api=new b.Api({aForm:this.aForm,url:this.url,user:a.user,password:a.password}),this.pk=this.form.getPkField(),"function"==typeof a.success&&a.success(this);else{this.ready=!1;var c=this,d={};a.user&&(d={Authorization:"Basic "+btoa(a.user+":"+a.password)}),jQuery.ajax({url:this.url+"schema",dataType:"json",headers:d,success:function(d){c.aForm=d,c.ready=!0,c.form=new b.Form({aForm:c.aForm,aParam:c.aParam,theme:c.theme}),c.api=new b.Api({aForm:c.aForm,url:c.url,user:a.user,password:a.password}),c.pk=c.form.getPkField(),"function"==typeof a.success&&a.success(c)},error:function(b){"function"==typeof a.error&&a.error(b)}})}},hasFunctions:function(){var a=!1;return this.aParam.user_function.upd&&1==this.aParam.user_function.upd&&(a=!0),this.aParam.user_function.inline&&1==this.aParam.user_function.inline&&(a=!0),this.aParam.user_function.del&&1==this.aParam.user_function.del&&(a=!0),this.aParam.user_function.ins&&1==this.aParam.user_function.ins&&(a=!0),this.aParam.custom_function&&(a=!0),a},createTable:function(a){var b=a.div_id;if("#"!=b.substring(0,1)&&(b="#"+b),this.ready){var c=this,d={success:function(b){c.generateTable(a,b)},error:function(a){try{var d=JSON.parse(a.responseText);jQuery(b).html(c.theme.alertMessage(d.message))}catch(e){a.statusText?jQuery(b).html(c.theme.alertMessage(a.statusText)):jQuery(b).html(c.theme.alertMessage(e+" "+a.responseText))}}};if(this.aParam.search){var e="";jQuery.each(this.aParam.search,function(a,b){e+="&"+a+"="+b}),d.search=e}this.api.select(d)}},generateTable:function(a,b){var c=a.div_id;"#"!=c.substring(0,1)&&(c="#"+c);var d=this;if(b.ok){var e=b.data,f=[];for(var g in d.aForm.fields){var h=d.form.getWidget(g);h.isVisible()&&!h.skipInTable()&&f.push(h.getTextLabel())}this.hasFunctions()&&f.push("Func.");var i=d.form.convert2html(e);if("function"==typeof d.prepare_cdata){var j=[];jQuery.each(e,function(a,b){j.push([b,i[a]])});var k=d.prepare_cdata(j);if(null!==k){var l=[],m=[];jQuery.each(k,function(a,b){l.push(b[0]),m.push(b[1])}),e=l,i=m}}var n=d.theme.getTable({data:i,rawData:e,header:f,aParam:d.aParam,options:{assignClass:!0,setIDRow:function(a){return"dbmng_row_id_"+a[d.pk]},addColumn:function(a){if(d.hasFunctions()){var b=d.theme.getTableCell();if(d.aParam.user_function.upd){var f=d.aParam.ui.btn_edit.label,g=d.aParam.ui.btn_edit,h=d.theme.getButton(f,g);d.isAllowed(a.rawData,"update")||(h.disabled=!0),h.addEventListener("click",function(){d.createForm(c,a.rawData[d.pk],e)}),jQuery(b).append(h)}if(d.aParam.user_function.inline){var i=d.aParam.ui.btn_edit_inline.label,j=d.aParam.ui.btn_edit_inline,k=d.theme.getButton(i,j);d.isAllowed(a.rawData,"update")||(k.disabled=!0),k.addEventListener("click",function(){d.createFormInline(c,a.rawData[d.pk],e,!0)}),jQuery(b).append(k)}if(d.aParam.user_function.del){var l=d.aParam.ui.btn_delete.label,m=d.aParam.ui.btn_delete,n=d.theme.getButton(l,m);d.isAllowed(a.rawData,"delete")||(n.disabled=!0),n.addEventListener("click",function(){var b="Are you sure?";d.aParam.ui.btn_delete.confirm_message&&(b=d.aParam.ui.btn_delete.confirm_message),window.confirm(b)&&d.deleteRecord(c,a.rawData[d.pk])}),jQuery(b).append(n)}if(d.aParam.custom_function){var o=d.aParam.custom_function;jQuery.isArray(d.aParam.custom_function)||(o=[d.aParam.custom_function]),jQuery.each(o,function(c,e){var f=e.label,g=e,h=d.theme.getButton(f,g);d.isAllowed(a.rawData,e.action)||(h.disabled=!0),e.action&&"string"==typeof e.action&&(h.addEventListener("click",function(){var b=e.action,c=[a.rawData[d.pk],a.rawData,a.data];exeExternalFunction(b,c)}),jQuery(b).append(h))})}return b}return null}}});if(jQuery(c).html(n),d.aParam.user_function.ins){var o=d.aParam.ui.btn_insert.label,p=d.aParam.ui.btn_insert,q=jQuery(d.theme.getButton(o,p));q.click(function(){d.createInsertForm(c)});var r="<div id='dbmng_buttons_row' class='row' style='margin-top: 20px;margin-bottom: 100px;'><div class='dbmng_form_button_message col-xs-12'></div><div id='dbmng_button_left' class='dbmng_form_button_left col-xs-4'></div><div id='dbmng_button_center' class='col-xs-4'></div><div id='dbmng_button_right' class='dbmng_form_button_right col-xs-4'></div></div>",s="<div id='dbmng_buttons_row' class='row' style='margin-top: 0px;margin-bottom: 0px;'><div class='dbmng_form_button_message col-xs-12'></div>   <div id='dbmng_button_left' class='dbmng_form_button_left col-xs-4'></div><div id='dbmng_button_center' class='col-xs-4'></div><div id='dbmng_button_right' class='dbmng_form_button_right col-xs-4'></div></div>",t="last";d.aParam.ui.btn_insert.position&&(t=d.aParam.ui.btn_insert.position),"first"==t?jQuery(c).prepend(s):"both"==t?(jQuery(c).append(r),jQuery(c).prepend(s)):jQuery(c).append(r),jQuery(c).find(".dbmng_form_button_left").append(q)}"function"==typeof d.table_ready&&d.table_ready()}else jQuery(c).html(d.theme.alertMessage(b.message))},isAllowed:function(a,b){return"function"==typeof this.aParam.user_function.custom_user_function?this.aParam.user_function.custom_user_function(a,b):!0},deleteRecord:function(a,b){var c=this;this.api["delete"]({key:b,success:function(b){"function"==typeof c.crud_success&&c.crud_success("delete",b),c.createTable({div_id:a})}})},createInsertForm:function(a){return this.createForm(a)},createForm:function(a,b,c){var d=this,e="update";"undefined"==typeof b&&(e="insert");var f;"update"===e?f=this.getARecord(b,c):(f={},this.aParam.search&&jQuery.each(this.aParam.search,function(a,b){f[a]=b})),jQuery(a).html(this.form.createForm(f,d.aParam.template_form)),"function"==typeof d.form_ready&&d.form_ready(e,this.form);var g=d.aParam.ui.btn_save.label,h=d.aParam.ui.btn_save,i="Cancel",j={};d.aParam.ui.btn_cancel&&(i=d.aParam.ui.btn_cancel.label,j=d.aParam.ui.btn_cancel);var k=d.theme.getButton(g,h);jQuery(k).click(function(){var c=d.form.isValid();c.ok===!1?jQuery(a).find(".dbmng_form_button_message").html(c.message):"update"==e?d.api.update({key:b,data:d.form.getValue(),success:function(b){if(b.ok)"function"==typeof d.crud_success&&d.crud_success("update",b),jQuery(a).html(""),d.createTable({div_id:a});else{var c=d.theme.alertMessage(b.message);jQuery(a).find(".dbmng_form_button_message").html(c)}}}):d.api.insert({data:d.form.getValue(),success:function(b){"function"==typeof d.crud_success&&d.crud_success("insert",b),jQuery(a).html(""),d.createTable({div_id:a})}})});var l=d.theme.getButton(i,j);jQuery(l).click(function(){jQuery(a).html(""),d.createTable({div_id:a})}),jQuery(a).append("<div id='dbmng_buttons_row' class='row' style='margin-top: 20px;margin-bottom: 100px;'><div class='dbmng_form_button_message col-xs-12'></div><div class='dbmng_form_button_left col-xs-4'></div><div class='col-xs-4'></div><div class='dbmng_form_button_right col-xs-4'></div></div>"),jQuery(a).find(".dbmng_form_button_left").append(l),jQuery(a).find(".dbmng_form_button_right").append(k)},getARecord:function(a,b){for(var c=null,d=0;d<b.length;d++)if(b[d][this.pk]==a){c=b[d];break}return c},createFormInline:function(a,c,d){var e=this,f=this.getARecord(c,d);jQuery("button").attr("disabled","true");var g=a+" table #dbmng_row_id_"+c,h=[];jQuery(g+" td").each(function(){h.push(jQuery(this).width())});for(var i=jQuery(g)[0];i.firstChild;)i.removeChild(i.firstChild);var j=this.form.getFields(f);for(var k in j)if(this.form.getWidget(k).isVisible()){var l=document.createElement("td");l.className="dbmng_cell_inline",l.appendChild(j[k]),i.appendChild(l)}jQuery(g).find("label").hide(),jQuery(g+" td.dbmng_cell_inline").each(function(a,c){jQuery(c).width(h[a]),!e.theme instanceof b.BootstrapTheme&&(jQuery(c).find("input").width(h[a]),jQuery(c).find("select").width(h[a]))}),"function"==typeof e.form_ready&&e.form_ready("update_inline",this.form);var m=e.aParam.ui.btn_save.label,n=e.aParam.ui.btn_save,o=e.theme.getButton(m,n);jQuery(o).click(function(){e.api.update({key:c,data:e.form.getValue(),success:function(b){"function"==typeof e.crud_success&&e.crud_success("update",b),jQuery("button").removeAttr("disabled"),jQuery(a).html(""),e.createTable({div_id:a})}})}),jQuery(g).append("<td class='dbmng_buttons'></td>"),jQuery(g+" td.dbmng_buttons").html(o)}}),b.CrudForm=a.extend({init:function(a){if(this.ready=!0,this.div_id=a.div_id,this.aParam=jQuery.extend(!0,{},b.defaults.aParam,a.aParam),this.form_ready=a.form_ready,this.crud_success=a.crud_success,a.theme?this.theme=a.theme:this.theme=b.defaults.theme,a.url?this.url=a.url:this.url="?","/"!=this.url.slice(-1)&&(this.url=this.url+"/"),this.aParam.url=this.url,a.aForm)this.aForm=a.aForm,this.form=new b.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme}),this.api=new b.Api({aForm:this.aForm,url:this.url,user:a.user,password:a.password}),this.pk=this.form.getPkField(),"function"==typeof a.success&&a.success(this);else{this.ready=!1;var c=this,d={};a.user&&(d={Authorization:"Basic "+btoa(a.user+":"+a.password)}),jQuery.ajax({url:this.url+"schema",dataType:"json",headers:d,success:function(d){c.aForm=d,c.ready=!0,c.form=new b.Form({aForm:c.aForm,aParam:c.aParam,theme:c.theme}),c.api=new b.Api({aForm:c.aForm,url:c.url,user:a.user,password:a.password}),c.pk=c.form.getPkField(),"function"==typeof a.success&&a.success(c)},error:function(b){"function"==typeof a.error&&a.error(b)}})}},createForm:function(a){if(this.ready){var b="update";"undefined"==typeof a&&(b="insert");var c=this,d=this.aForm.primary_key[0];"update"==b?this.api.select({search:d+"="+a,success:function(e){c.generateForm(b,d,a,e)}}):"insert"==b&&c.generateForm(b,d)}},generateForm:function(a,b,c,d){var e=this;jQuery("#"+e.div_id).html(""),"undefined"!=typeof d?jQuery("#"+e.div_id).append(e.form.createForm(d.data[0],e.aParam.template_form)):jQuery("#"+e.div_id).append(e.form.createForm()),"function"==typeof e.form_ready&&e.form_ready(a,this.form);var f=e.aParam.ui.btn_save.label,g=e.aParam.ui.btn_save,h="Cancel",i={};e.aParam.ui.btn_cancel&&(h=e.aParam.ui.btn_cancel.label,i=e.aParam.ui.btn_cancel);var j=e.theme.getButton(f,g);jQuery(j).click(function(){var d=e.form.isValid();d.ok===!1?jQuery("#"+e.div_id).find(".dbmng_form_button_message").html(d.message):"update"==a?e.api.update({key:b,data:e.form.getValue(),success:function(a){if(a.ok)"function"==typeof e.crud_success&&e.crud_success("update",a),e.createForm(c);else{var b=e.theme.alertMessage(a.message);jQuery("#"+e.div_id).find(".dbmng_form_button_message").html(b)}}}):"insert"==a&&e.api.insert({data:e.form.getValue(),success:function(a){"function"==typeof e.crud_success&&e.crud_success("insert",a),jQuery(e.div_id).html(""),e.createForm(a.inserted_id)}})});var k=e.theme.getButton(h,i);jQuery(k).click(function(){jQuery("#"+e.div_id).html("")}),jQuery("#"+e.div_id).append("<div id='dbmng_buttons_row' class='row' style='margin-top: 20px;margin-bottom: 100px;'><div class='dbmng_form_button_message col-xs-12'></div><div class='dbmng_form_button_left col-xs-4'></div><div class='col-xs-4'></div><div class='dbmng_form_button_right col-xs-4'></div></div>"),jQuery("#"+e.div_id).find(".dbmng_form_button_left").append(k),jQuery("#"+e.div_id).find(".dbmng_form_button_right").append(j)}}),b.CrudInline=b.Crud.extend({generateTable:function(a,c){var d=a.div_id;"#"!=d.substring(0,1)&&(d="#"+d);var e=this,f=jQuery.extend(!0,{},this.aParam);f.hide_label=!0,f.hide_placeholder=!0;var g=new b.FormInline({aForm:this.aForm,aParam:f,onChange:function(){var a=this,b={};b[a.field]=a.getValue(),e.api.update({key:a.pk_value,data:b,success:function(b){a.setErrorState(b.ok,b.message)},error:function(b){jQuery(jQuery(a.widget).parents("td")[0]).removeClass("success").addClass("danger")}})},onChangeRow:function(){}}),h=g.createForm(c.data);jQuery(d).append(h)}}),b.AbstractTheme=a.extend({test:function(a){return a+2},getFieldContainer:function(a){var b=document.createElement("div");return b.className="dbmng_form_row",b.className=b.className+" dbmng_form_field_"+a.field,b},getLabel:function(a){var b=document.createElement("div");b.className="dbmng_form_label";var c=document.createElement("label");c.setAttribute("for","dbmng_"+a.field);var d=a.label;a.label_long&&(d=a.label_long);var e=document.createElement("div");e.innerHTML="<span>"+d+"</span>";var f=e.firstChild;if(c.appendChild(f),0===parseInt(a.nullable)){var g=document.createElement("span");g.className="dbmng_required";var h=document.createTextNode("*");g.appendChild(h),c.appendChild(g)}return b.appendChild(c),b},getInput:function(a){var b=document.createElement("input");return this.assignAttributes(b,a),"undefined"!=typeof a.value&&(b.value=a.value),a.placeholder?b.placeholder=a.placeholder:b.type="text",a.field_type&&(b.type=a.field_type),b},getCheckbox:function(a){var b=document.createElement("input");return this.assignAttributes(b,a),b.type="checkbox",1==a.value&&(b.checked=!0),a.placeholder&&(b.placeholder=a.label),b},getSelect:function(a){var b=document.createElement("select");if(this.assignAttributes(b,a),a.voc_val){var c=document.createElement("option");a.placeholder&&(c.text=a.label,c.disabled="disabled"),b.options.add(c);for(var d in a.voc_val)c=document.createElement("option"),c.value=d,c.text=a.voc_val[d],"undefined"!=typeof a.value&&a.value==d&&(c.selected=!0),b.options.add(c)}return b},getSelectNM:function(a){var c,d,e,f="select";if("checkbox"==a.out_type&&(f="checkbox"),"select"==f){if(c=document.createElement("select"),c.multiple=!0,this.assignAttributes(c,a),a.voc_val){d=document.createElement("option"),a.placeholder&&(d.text=a.label,d.disabled="disabled"),c.options.add(d);for(e in a.voc_val)d=document.createElement("option"),d.value=e,d.text=a.voc_val[e],a.value&&("number"==typeof a.value[0]&&(e=parseInt(e)),a.value.indexOf(e)>-1&&(d.selected=!0)),c.options.add(d)}}else if("checkbox"==f){c=document.createElement("ul"),this.assignAttributes(c,a);for(e in a.voc_val){var g=document.createElement("li"),h={type:"int",widget:"checkbox",theme:this};d=new b.CheckboxWidget({field:a.field,aField:h}),d.createField(e),g.appendChild(d.widget);var i=document.createTextNode(a.voc_val[e]);g.appendChild(i),c.appendChild(g)}}return c},assignAttributes:function(a,b){b.field&&(a.name=b.field),b.nullable===!1&&(a.required=!0),1==b.readonly&&(a.disabled="disabled"),b.classes&&this.addClass(a,b.classes)},addClass:function(a,b){var c="";a.className?a.className.length>0&&(c=" "):a.className="",a.className=a.className+c+b},addTitle:function(a,b){a.title=b},getForm:function(a){var b=document.createElement("form");return b},getTextarea:function(a){var b=document.createElement("textarea");return this.assignAttributes(b,a),a.value&&(b.value=a.value),a.placeholder&&(b.placeholder=a.placeholder),b},getTable:function(a){var b=document.createElement("div"),c=document.createElement("table");if(a.aParam&&a.aParam.ui&&a.aParam.ui.table_class&&this.addClass(c,a.aParam.ui.table_class),a.rawData||(a.rawData=a.data),a.data){c.appendChild(this.getTableHeader(a));for(var d=document.createElement("tbody"),e=0;e<a.data.length;e++){var f=this.getTableRow({data:a.data[e],rawData:a.rawData[e],options:a.options});if(a.options&&(a.options.assignClass&&this.addClass(f,"dbmng_row dbmng_row_"+e),"function"==typeof a.options.addColumn)){var g=a.options.addColumn({data:a.data[e],rawData:a.rawData[e],options:a.options});null!==g&&f.appendChild(g)}d.appendChild(f)}c.appendChild(d)}return b.appendChild(c),b},getTableHeader:function(a){var b=document.createElement("thead"),c=document.createElement("tr"),d=[],e=0;if(a.data&&a.data.length>0)for(var f in a.data[0])d[e]=f,e++;a.header||(a.header=d);for(var g=0;g<a.header.length;g++){var h=this.getTableHCell({content:a.header[g],options:a.options});a.options&&a.options.assignClass&&this.addClass(h,"dbmng_cell dbmng_head dbmng_col_"+d[g]),c.appendChild(h)}return b.appendChild(c),b},getTableRow:function(a){var b=document.createElement("tr");if(a.data)for(var c in a.data){var d=this.getTableCell({content:a.data[c],options:a.options});a.options&&(a.options.assignClass&&this.addClass(d,"dbmng_cell dbmng_col_"+c),"function"==typeof a.options.setIDRow&&(b.id=a.options.setIDRow(a.rawData))),b.appendChild(d)}return b},getTableHCell:function(a){a||(a={});var b=document.createElement("th");return a.content&&b.appendChild(document.createTextNode(a.content)),b},getTableCell:function(a){a||(a={});var b=document.createElement("td");return a.content&&b.appendChild(document.createTextNode(a.content)),b},getButton:function(a,b){b||(b={});var c="button";b.type&&(c=b.type);var d=document.createElement(c);if(b["class"]&&this.addClass(d,b["class"]),b.icon){var e=document.createElement("i");if(this.addClass(e,b.icon),this.addTitle(e,a),d.appendChild(e),b.label_file){var f=document.createElement("span");f.appendChild(document.createTextNode(" "+b.label_file)),d.appendChild(f)}}else d.appendChild(document.createTextNode(a));return d},alertMessage:function(a){var b=document.createElement("div");return this.addClass(b,"dbmng_alert"),b.appendChild(document.createTextNode(a)),b},createFileUploadField:function(a,b,c){var d=document.createElement("div");this.addClass(d,"dbmng_fileupload_meta_container");var e=document.createElement("div");this.addClass(e,"dbmng_fileupload_container"),d.appendChild(e),d.appendChild(document.createElement("br"));var f=document.createElement("div");this.addClass(f,"dbmng_fileupload_button_progress"),d.style.cssText="width:100%; float:left;",f.appendChild(this.createFormUpload(a,b,c));var g=this.createProgressBar({"class":"progress",width:"69"});return f.appendChild(g),d.appendChild(f),d},createFormUpload:function(a,b,c){c||(c={}),c["class"]||(c["class"]=""),c.type="a";var d=this.getButton(b,c);return this.addClass(d,"fileinput-button"),d.style.cssText="float:left; width:30%",d.appendChild(a),d},createProgressBar:function(a){a||(a={}),a["class"]||(a["class"]=""),a.width||(a.width=100);var b=document.createElement("div");this.addClass(b,a["class"]),b.style.cssText="width:"+a.width+"%; border:1px solid #CCC; height:20px; float:left;";var c=document.createElement("div");return this.addClass(c,"progress-bar progress-bar-success"),c.style.cssText="background-color:#CCC; height:20px; width:0px;",b.appendChild(c),b},getDeleteButton:function(a){var b=this.getButton("X",{type:"span"});return b}}),b.BootstrapTheme=b.AbstractTheme.extend({getLabel:function(a){var b=this._super(a);return jQuery(b).css("font-weight","bold"),b},assignAttributes:function(a,b){this._super(a,b),this.addClass(a,"form-control")},alertMessage:function(a){var b=this._super(a);return this.addClass(b,"alert alert-block alert-danger"),b},getTable:function(a){var b=this._super(a);return this.addClass(b.firstChild,"table"),b},getButton:function(a,b){var c=this._super(a,b);return this.addClass(c,"btn btn-default"),c},createFileUploadField:function(a,b,c){var d=this._super(a,b,c),e=jQuery(d).find(".fileinput-button");e.css("width",""),e.addClass("col-xs-6");var f=jQuery(d).find(".progress");return f.css("width",""),f[0].style.cssText="",f.wrap('<div class="col-xs-6" style="padding-top: 7px;"></div>'),f.find(".progress-bar")[0].style.cssText="",d},getDeleteButton:function(a,b){var c=document.createElement("i");return this.addClass(c,b),this.addTitle(c,a),c}}),b.AbstractWidget=a.extend({init:function(a){a||(a={}),a.field&&(this.field=a.field),a.aField&&(this.aField=a.aField),a.theme?this.theme=a.theme:this.theme=new b.AbstractTheme,a.aParam?this.aParam=a.aParam:this.aParam={},this.widget=null},createWidget:function(){this.aField.value=this.getFieldValue();var a=this.theme.getInput(this.aField);return a},createField:function(a){var b=this;this.aField.field=this.field;var c=this.theme.getFieldContainer(this.aField),d=this.getLabel();null!==d&&c.appendChild(d),"undefined"!=typeof a&&(this.value=a);var e=this.createWidget();return this.widget=e,e.onchange=function(a){b.onChange(a)},e.onfocus=function(a){b.onFocus(a)},c.appendChild(e),c},isVisible:function(){return!0},skipInTable:function(){return 1==this.aField.skip_in_tbl?!0:!1},getTextLabel:function(){return this.aField.label?this.aField.label:this.field},getLabel:function(){var a=!1;if(this.aParam.hide_label&&this.aParam.hide_label===!0){a=!0;var b=!0;this.aParam.hide_placeholder===!0&&(b=!1),b&&(this.aField.placeholder=this.aField.label)}return a?null:this.theme.getLabel(this.aField)},onChange:function(a){this.isValid()},onFocus:function(a){},setValue:function(a){var b=0;return this.widget&&(this.widget.value=a,b=1),b},getValue:function(){return this.widget?this.widget.value:null},getDefaultValue:function(a){return""},getFieldValue:function(){var a;return a="undefined"!=typeof this.value?this.value:this.aField["default"]?this.aField["default"]:this.getDefaultValue()},convert2html:function(a){return a},setErrorState:function(a,b){var c=jQuery(jQuery(this.widget).parents(".dbmng_form_row")[0]);c.find("span.error_message").remove(),a?c.removeClass("alert-danger").addClass("alert-success"):(c.append('<span class="error_message">'+b+"</span>"),c.removeClass("alert-success").addClass("alert-danger"))},isValidCustom:function(){return{ok:!0}},isValid:function(){var a=!1,b=0;"undefined"!=typeof this.aField.nullable&&(b=parseInt(this.aField.nullable));var c=!0,d="";if(this.toValidate(b)&&(a=!0,(null===this.getValue()||""===this.getValue())&&(c=!1,d="Empty Field ["+this.aField.field+"]")),"undefined"!=typeof this.aField.validator){a=!0;var e,f;"email"==this.aField.validator?(e=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,f="You need to enter a valid email"):"url"==this.aField.validator?(e=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/,f="You need to enter a valid URL"):"ip"==this.aField.validator&&(e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,f="You need to enter a IP address");var g=e.test(this.getValue());g||(c=g,d=f)}var h=this.isValidCustom();return h.ok||(c=!h.ok,d+=" "+h.message),a&&this.setErrorState(c,d),{ok:c,message:d}},toValidate:function(a){return 0===a&&"hidden"!=this.aField.field_type&&1!=this.aField.key}}),b.AutocompleteWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="hidden",this.theme.getInput(this.aField)},createField:function(a){var b=this,c=this._super(a),d={};d.field=this.aField.field+"_view",d.classes="typeahead";var e=this.theme.getInput(d);if(c.appendChild(e),"undefined"!=typeof Bloodhound){var f=new Bloodhound({datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace("<b>"+a[1]+"</b>: "+a[3])},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:b.aField.url,wildcard:"%QUERY",transform:function(a){var b=[];return jQuery.each(a.data,function(a,c){b.push(c)}),b}}});""!==a&&"undefined"!=typeof a&&""!==a&&f.search(a,function(a){b.autocomplete_get(a,e)},function(a){b.autocomplete_get(a,e)});var g="key";b.aField.autocomplete_key&&(g=b.aField.autocomplete_key);var h="label";b.aField.autocomplete_fieldname&&(h=b.aField.autocomplete_fieldname);var i="Not found ";b.aField.not_found&&(i=b.aField.not_found),jQuery(e).typeahead({hint:!0,highlight:!0,minLength:0},{name:b.aField.autocomplete_fieldname,source:f,limit:100,display:b.aField.autocomplete_fieldname,templates:{header:"",notFound:function(a){return i+" <b>"+a.query+"<b>"},suggestion:Handlebars.compile("<div>{{"+h+"}}</div>")}}),jQuery(e).bind("typeahead:select",function(a,c){b.widget.value=c[g]})}else c.appendChild(jQuery("<div class='alert alert-danger'><strong>DBMNG2 Error!</strong><p>Bloodhound library is not loaded</p></div>")[0]);return c},autocomplete_get:function(a,b){if(a.length>0){var c=a[0][this.aField.autocomplete_fieldname];b.value=c}}}),b.CheckboxWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.theme.getCheckbox(this.aField)},getValue:function(){var a;return a="int"==this.aField.type?this.widget.checked?1:0:this.widget.checked},convert2html:function(a){return this.aField.voc_val?this.aField.voc_val[a]:a}}),b.DateWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),"undefined"!=typeof jQuery.datepicker?this.aField.field_type="hidden":this.aField.field_type="date",this.theme.getInput(this.aField)},createField:function(a){var b=this,c="dd-mm-yy";b.aField.date_format_view&&(c=b.aField.date_format_view);var d=this._super(a);if("undefined"!=typeof jQuery.datepicker){var e={};e.field=this.aField.field+"_view";var f=this.theme.getInput(e);"undefined"!=typeof a&&""!==a&&null!==a&&(f.value=jQuery.datepicker.formatDate(c,jQuery.datepicker.parseDate("yy-mm-dd",a))),jQuery(f).blur(function(){""===jQuery(f).val()&&(b.widget.value="")}),jQuery(f).datepicker({altField:jQuery(b.widget),dateFormat:c,altFormat:"yy-mm-dd"}),d.appendChild(f)}return d},getValue:function(){var a=this._super();return""===a?null:a}}),b.FileWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),"undefined"!=typeof jQuery().fileupload?this.aField.field_type="hidden":this.aField.field_type="file",this.theme.getInput(this.aField)},createField:function(a){var b=this,c="server/php/";b.aParam.url&&(c=b.aParam.url+"file/"+b.field+"/"),b.aField.url&&(c=b.aField.url);var d=c+"files/";b.aField.weburl_file&&(d=b.aField.weburl_file);var e=this._super(a);if("undefined"!=typeof jQuery().fileupload){var f={};f.field=this.aField.field+"_file";var g=this.theme.getInput(f);g.type="file",g.name="files[]";var h={},i="btn btn-success",j="glyphicon glyphicon-plus",k="Select file...",l="Uploading...";b.aField["class"]&&(i=b.aField["class"]),b.aField.add_icon&&(j=b.aField.add_icon),b.aField.label_file&&(k=b.aField.label_file),b.aField.uploading_text&&(l=b.aField.uploading_text),
h["class"]=i,h.icon=j,h.label_file=k,e.appendChild(this.theme.createFileUploadField(g,k,h));var m=jQuery(e).find(".progress"),n=jQuery(e).find(".dbmng_fileupload_container");"undefined"!=typeof a&&""!==a&&null!==a&&b.addFile(n,d,a),jQuery(g).fileupload({url:c,dataType:"json",add:function(a,b){n.html(l),b.submit()},progressall:function(a,b){var c=parseInt(b.loaded/b.total*100,10);jQuery(m).find(".progress-bar").css("width",c+"%")},fail:function(a,c){n.html(b.theme.alertMessage("Error"))},done:function(a,c){c.result.files?c.result.files.length>0?(n.html(""),jQuery.each(c.result.files,function(a,c){c.error?n.append(b.theme.alertMessage(c.error)):(b.addFile(n,d,c.name),b.setValue(c.name))})):(n.html(""),jQuery.each(c.messages,function(a,c){n.append(b.theme.alertMessage(c))})):n.append(b.theme.alertMessage(c.result.message))}})}return e},addFile:function(a,b,c){var d=this,e="glyphicon glyphicon-remove";d.aField.remove_icon&&(e=d.aField.remove_icon);var f="Delete";d.aField.remove_title_icon&&(f=d.aField.remove_title_icon),a.append("<a target='_NEW' class='dbmng_fileupload_filelink' href='"+b+c+"'>"+this.assignFileTypeIcon(c)+" "+c+"</a>&nbsp;");var g=this.theme.getDeleteButton(f,e);a.append(g),jQuery(g).click(function(){a.html(""),d.setValue("")})},assignFileTypeIcon:function(a){var b=a.split("."),c="";return"pdf"==b[1]&&(c='<i class="fa fa-file-pdf-o"></i>'),c}}),b.HiddenWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="hidden",this.theme.getInput(this.aField)},getLabel:function(){return null},isVisible:function(){return!1}}),b.NumericWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="number",this.theme.getInput(this.aField)},getValue:function(){var a=this._super();if(""===a)return null;var b=1*a;return isNaN(b)?null:b}}),b.PasswordWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="password",this.theme.getInput(this.aField)}}),b.SelectNMWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field=this.field,this.theme.getSelectNM(this.aField)},getValue:function(){var a,b,c="select";if("checkbox"==this.aField.out_type&&(c="checkbox"),"select"==c)"int"==this.aField.type?(a=[].concat(jQuery(this.widget).val()),b=[],a.forEach(function(a){b.push(parseInt(a))})):b=jQuery(this.widget).val();else if("checkbox"==c){var d=jQuery(this.widget).children("li").children();a=[],d.each(function(b,c){c.checked&&a.push(parseInt(c.value))}),b=a}return b}}),b.SelectWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field=this.field,this.theme.getSelect(this.aField)},getValue:function(){var a;return a="int"==this.aField.type?parseInt(jQuery(this.widget).val()):jQuery(this.widget).val()},convert2html:function(a){return this.aField.voc_val[a]}}),b.TextareaWidget=b.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="password",this.theme.getTextarea(this.aField)}}),b.defaults.theme=new b.AbstractTheme,b.defaults.aParam={ui:{btn_edit:{label:"Edit"},btn_edit_inline:{label:"Edit inline"},btn_delete:{label:"Delete"},btn_insert:{label:"Insert"},btn_save:{label:"Save"},btn_cancel:{label:"Cancel"}},user_function:{inline:0,upd:1,del:1,ins:1}},window.Dbmng=b}();