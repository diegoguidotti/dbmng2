function exeExternalFunction(e,t){e=window[e];return"function"==typeof e&&(void 0===t?e():e.apply(null,t))}void 0===window.console&&(window.console={log:function(e){}}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.indexOf(e)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),function(){function p(){}var e,r,s;r=!1,s=/xyz/.test(function(){window.postMessage("xyz")})?/\b_super\b/:/.*/,(e=function(){}).extend=function(e){var t,n=this.prototype,a=(r=!0,new this);for(t in r=!1,e)a[t]="function"==typeof e[t]&&"function"==typeof n[t]&&s.test(e[t])?function(a,i){return function(){var e=this._super,t=(this._super=n[a],i.apply(this,arguments));return this._super=e,t}}(t,e[t]):e[t];function i(){!r&&this.init&&this.init.apply(this,arguments)}return((i.prototype=a).constructor=i).extend=arguments.callee,i};p.defaults={},p.Form=e.extend({init:function(e){this.aForm=e.aForm,e.aParam||(e.aParam={}),this.aParam=jQuery.extend(!0,{},p.defaults.aParam,e.aParam),e.theme?this.theme=e.theme:this.theme=p.defaults.theme,this.createWidgets()},createWidgets:function(){for(var e in this.widgets={},this.aForm.fields){var t,a=this.aForm.fields[e],i="",n=(a.widget&&(i=a.widget),{field:e,aField:a,theme:this.theme,aParam:this.aParam});void 0===a.external_widget?t=new("select"==i?p.SelectWidget:"radio"==i?p.RadioWidget:"select_nm"==i?p.SelectNMWidget:"password"==i?p.PasswordWidget:"hidden"==i?p.HiddenWidget:"checkbox"==i?p.CheckboxWidget:"numeric"==i?p.NumericWidget:"autocomplete"==i?p.AutocompleteWidget:"date"==i?p.DateWidget:"textarea"==i?p.TextareaWidget:"file"==i?p.FileWidget:p.AbstractWidget)(n):"function"==typeof a.external_widget&&(t=new a.external_widget(n)),this.widgets[e]=t}},getPkField:function(){if(this.aForm.primary_key){if(1<this.aForm.primary_key.length)throw"There are more primary keys field";return this.aForm.primary_key[0]}throw"Missing primary key in aForm"},getWidget:function(e){return this.widgets[e]},getPkValue:function(){return this.widgets[this.getPkField()].getValue()},getValue:function(){var e,t={};for(e in this.aForm.fields)t[e]=this.widgets[e].getValue();return t},convert2html:function(e){for(var t=[],a=0;a<e.length;a++){var i,n={};for(i in this.aForm.fields)this.widgets[i].isVisible()&&!this.widgets[i].skipInTable()&&(n[i]=this.widgets[i].convert2html(e[a][i],e[a]));t.push(n)}return t},getFields:function(e){var t,a={};for(t in this.createWidgets(),this.aForm.fields){var i=e?this.widgets[t].createField(e[t]):this.widgets[t].createField();void 0!==this.aForm.fields[t].skip_in_form&&this.aForm.fields[t].skip_in_form||(a[t]=i)}return a},isValid:function(){var e,t=!0,a="";for(e in this.widgets){var i=this.widgets[e].isValid();!1===i.ok&&(t=!1,a+="Field "+this.widgets[e].field+": "+i.message+"<br/>")}return{ok:t,message:a}},createForm:function(e,t){var a=this.getFields(e),e=!0;if(void 0!==t&&0<jQuery(t).length&&(i=jQuery(t),e=!1),e){var i,n,r=i=this.theme.getForm();for(n in i.firstChild&&(r=i.firstChild),a)r.appendChild(a[n])}else for(var s in a){var d=i.find("[data-content="+s+"]");(0===d.length?i:d).append(a[s])}return i}}),p.Table=e.extend({init:function(e){this.prepare_cdata=e.prepare_cdata,e.aParam||(e.aParam={}),this.aParam=e.aParam,e.theme?this.theme=e.theme:this.theme=p.defaults.theme,e.aForm&&(this.aForm=e.aForm,this.form=new p.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme}),this.pk=this.form.getPkField(),"function"==typeof e.success&&e.success(this))},generateTable:function(e,t){var e=e.div_id,r=("#"!=e.substring(0,1)&&(e="#"+e),this);if(t.ok){var a,s=t.data,i=[];for(a in r.aForm.fields){var n=r.form.getWidget(a);n.isVisible()&&!n.skipInTable()&&i.push(n.getTextLabel())}this.hasFunctions()&&i.push("Func.");var d,l,o,u=r.form.convert2html(s),c=("function"==typeof r.prepare_cdata&&(d=[],jQuery.each(s,function(e,t){d.push([t,u[e]])}),null!==(c=r.prepare_cdata(d))&&(l=[],o=[],jQuery.each(c,function(e,t){l.push(t[0]),o.push(t[1])}),s=l,u=o)),r.theme.getTable({data:u,rawData:s,header:i,aParam:r.aParam,options:{assignClass:!0,setIDRow:function(e){return"dbmng_row_id_"+e[r.pk]},addColumn:function(i){var n,e;return r.hasFunctions()?(n=r.theme.getTableCell(),r.aParam.custom_function&&(e=r.aParam.custom_function,e=(e=jQuery.isArray(r.aParam.custom_function)?e:[r.aParam.custom_function]).sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}),jQuery.each(e,function(e,t){var a=t.label,a=r.theme.getButton(a,t);"function"!=typeof t.isAllowed||t.isAllowed(i.rawData)||(a.disabled=!0),!t.action||"string"!=typeof t.action&&"function"!=typeof t.action||(a.addEventListener("click",function(){"string"==typeof t.action?exeExternalFunction(t.action,[i.rawData[r.pk],i.rawData,i.data,s]):t.action(i.rawData[r.pk],i.rawData,i.data,s)}),jQuery(n).append(a))})),n):null}}}));jQuery(e).html(c)}else jQuery(e).html(r.theme.alertMessage(t.message))},hasFunctions:function(){var e=!1;return e=this.aParam.custom_function?!0:e}}),p.FormInline=e.extend({init:function(e){this.aForm=e.aForm,e.aParam||(e.aParam={}),this.aParam=jQuery.extend(!0,{},p.defaults.aParam,e.aParam),e.theme?this.theme=e.theme:this.theme=p.defaults.theme,e.onChange&&(this.onChange=e.onChange),e.onChangeRow&&(this.onChangeRow=e.onChangeRow),e.addEachRow&&(this.addEachRow=e.addEachRow)},getTransaction:function(){for(var e=[],t=0;t<this.forms.length;t++){var a={mode:"update",key:this.forms[t].getPkValue(),body:this.forms[t].getValue()};e.push(a)}return e},getValue:function(){for(var e=[],t=0;t<this.forms.length;t++)e.push(this.forms[t].getValue());return e},isValid:function(){for(var e=!0,t=[],a=0;a<this.forms.length;a++){var i=this.forms[a].isValid();i.ok||(e=!1,t.push({message:i.message,record:a}))}return{ok:e,messages:t}},createForm:function(c){var e,t,a,h=this,i=document.createElement("div"),m=(h.main_node=i,this.theme.getTable({data:[],header:[],aParam:this.aParam})),n=(this.forms=[],new p.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme}));for(e in this.aForm.fields)n.getWidget(e).isVisible()&&(t=this.aForm.fields[e],jQuery(m).find("thead tr").append(this.theme.getTableHCell({content:t.label})));return jQuery.each(c,function(e,t){var a,i,n,r=e,s=new p.Form({aForm:h.aForm,aParam:h.aParam,theme:h.theme}),d=(h.forms.push(s),s.getFields(c[e])),l=jQuery("<tr></tr>").appendTo(jQuery(m).find("tbody"));for(a in d){var o,u=s.getWidget(a);u.isVisible()?jQuery("<td></td>").appendTo(l).append(d[a]):(o=jQuery(d[a]).hide()[0],l.append(o)),u.pk_value=s.getPkValue(),u.form=s,h.onChange&&(u.onChange=h.onChange),h.onChangeRow&&(u.onFocus=h.onChangeRow)}h.aParam.do_delete&&(i=jQuery("<td></td>").appendTo(l),n="Del",h.aParam.del_label&&(n=h.aParam.del_label),r=jQuery('<button data-record="'+r+'">'+n+"</button>")[0],i[0].appendChild(r),jQuery(r).click(function(){var e=h.getValue(),t=jQuery(this).attr("data-record");e.splice(t,1),h.main_node.innerHTML="",h.main_node.appendChild(h.createForm(e))})),this.addEachRow&&this.addEachRow(l,c[e])}),i.appendChild(m),!0===h.aParam.do_insert&&(a=h.theme.getButton("Insert",{class:"insert_button"}),i.appendChild(a),a.addEventListener("click",function(){var e=h.getValue();e.push({}),h.main_node.innerHTML="",h.main_node.appendChild(h.createForm(e))})),i}}),p.Api=e.extend({init:function(e){this.url=e.url,this.user=e.user,this.password=e.password,this.search=e.search,"/"!=this.url.slice(-1)&&(this.url=this.url+"/")},getHeaders:function(){return{Authorization:"Basic "+btoa(this.user+":"+this.password)}},select:function(t){var e=this.url;t.search&&(e+="?"+t.search),jQuery.ajax({url:e,dataType:"json",headers:this.getHeaders(),success:function(e){"function"==typeof t.success&&t.success(e)},error:function(e){"function"==typeof t.error&&t.error(e)}})},transaction:function(t){jQuery.ajax({url:this.url+"transaction",dataType:"json",method:"POST",data:JSON.stringify(t.data),headers:this.getHeaders(),success:function(e){"function"==typeof t.success&&t.success(e)},error:function(e){"function"==typeof t.error&&t.error(e)}})},insert:function(t){jQuery.ajax({url:this.url,dataType:"json",method:"POST",data:JSON.stringify(t.data),headers:this.getHeaders(),success:function(e){"function"==typeof t.success&&t.success(e)},error:function(e){"function"==typeof t.error&&t.error(e)}})},update:function(t){jQuery.ajax({url:this.url+t.key,dataType:"json",method:"POST",data:JSON.stringify(t.data),headers:this.getHeaders(),success:function(e){"function"==typeof t.success&&t.success(e)},error:function(e){"function"==typeof t.error&&t.error(e)}})},delete:function(t){jQuery.ajax({url:this.url+t.key,dataType:"json",method:"DELETE",headers:this.getHeaders(),success:function(e){"function"==typeof t.success&&t.success(e)},error:function(e){"function"==typeof t.error&&t.error(e)}})}}),p.Crud=e.extend({init:function(t){var a,i=this,e=(this.ready=!0,this.crud_success=t.crud_success,this.form_ready=t.form_ready,this.table_ready=t.table_ready,this.table_success=t.table_success,this.prepare_cdata=t.prepare_cdata,this.form_validation=t.form_validation,this.crud_delete=t.crud_delete,this.crud_insert=t.crud_insert,this.crud_update=t.crud_update,t.aParam||(t.aParam={}),this.aParam=jQuery.extend(!0,{},p.defaults.aParam,t.aParam),t.theme?this.theme=t.theme:this.theme=p.defaults.theme,t.url?this.url=t.url:this.url="?","/"!=this.url.slice(-1)&&(this.url=this.url+"/"),this.aParam.url=this.url,{url:i.url,user:t.user,password:t.password});void 0!==this.offline&&(e.offline=this.offline),i.api=new p.Api(e),t.aForm?(this.aForm=t.aForm,this.form=new p.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme}),this.pk=this.form.getPkField(),"function"==typeof t.success&&t.success(this)):(this.ready=!1,e={},t.user&&(e={Authorization:"Basic "+btoa(t.user+":"+t.password)}),a="?",this.aParam.search&&jQuery.each(this.aParam.search,function(e,t){a+="&"+e+"="+t}),jQuery.ajax({url:this.url+"schema"+a,dataType:"json",headers:e,success:function(e){i.aForm=e,i.ready=!0,i.form=new p.Form({aForm:i.aForm,aParam:i.aParam,theme:i.theme}),i.pk=i.form.getPkField(),"function"==typeof t.success&&t.success(i)},error:function(e){"function"==typeof t.error?t.error(e):window.alert("API ["+this.url+"schema"+a+"] not found")}}))},hasFunctions:function(){var e=!1;return this.aParam.user_function.upd&&1==this.aParam.user_function.upd&&(e=!0),this.aParam.user_function.inline&&1==this.aParam.user_function.inline&&(e=!0),this.aParam.user_function.del&&1==this.aParam.user_function.del&&(e=!0),this.aParam.user_function.ins&&1==this.aParam.user_function.ins&&(e=!0),e=this.aParam.custom_function?!0:e},createTable:function(t){var a,e,i,n=t.div_id;"#"!=n.substring(0,1)&&(n="#"+n),this.ready&&(e={success:function(e){a.generateTable(t,e)},error:function(t){try{var e=JSON.parse(t.responseText);jQuery(n).html(a.theme.alertMessage(e.message))}catch(e){t.statusText?jQuery(n).html(a.theme.alertMessage(t.statusText)):jQuery(n).html(a.theme.alertMessage(e+" "+t.responseText))}}},(a=this).aParam.search&&(i="",jQuery.each(this.aParam.search,function(e,t){i+="&"+e+"="+t}),e.search=i),this.api.select(e))},generateTable:function(e,t){var r=e.div_id,s=("#"!=r.substring(0,1)&&(r="#"+r),this),a=[];s.aParam.custom_function?Array.isArray(s.aParam.custom_function)?jQuery.each(s.aParam.custom_function,function(e,t){t.order||(t.order=10*(e+1))}):((a=s.aParam.custom_function).order||(a.order=10),s.aParam.custom_function=[],s.aParam.custom_function.push(a)):s.aParam.custom_function=[],s.aParam.user_function&&s.aParam.user_function.upd&&!s.aParam.user_function.added_upd&&((a=s.aParam.ui.btn_edit).action=function(e,t,a,i){s.createForm(r,e,i)},a.isAllowed=function(e){return s.isAllowed(e,"update")},a.order=1,s.aParam.custom_function.push(a),s.aParam.user_function.added_upd=!0),s.aParam.user_function&&s.aParam.user_function.inline&&!s.aParam.user_function.added_inline&&((a=s.aParam.ui.btn_edit_inline).action=function(e,t,a,i){s.createFormInline(r,e,i,!0)},a.isAllowed=function(e){return s.isAllowed(e,"update")},a.order=2,s.aParam.custom_function.push(a),s.aParam.user_function.added_inline=!0),s.aParam.user_function&&s.aParam.user_function.del&&!s.aParam.user_function.added_delete&&((a=s.aParam.ui.btn_delete).action=function(e,t,a,i){var n="Are you sure?";s.aParam.ui.btn_delete.confirm_message&&(n=s.aParam.ui.btn_delete.confirm_message),window.confirm(n)&&s.deleteRecord(r,e)},a.isAllowed=function(e){return s.isAllowed(e,"delete")},a.order=100,s.aParam.custom_function.push(a),s.aParam.user_function.added_delete=!0);new p.Table({theme:s.theme,aForm:s.aForm,aParam:s.aParam,prepare_cdata:s.prepare_cdata}).generateTable(e,t);var i,a=t.data;"function"==typeof s.table_success&&s.table_success(a),s.aParam.user_function&&s.aParam.user_function.ins&&(e=s.aParam.ui.btn_insert.label,t=s.aParam.ui.btn_insert,(a=jQuery(s.theme.getButton(e,t))).click(function(){s.createInsertForm(r)}),e="<div id='dbmng_buttons_row' class='row' style='margin-top: 20px;margin-bottom: 100px;'><div class='dbmng_form_button_message col-md-12'></div><div id='dbmng_button_left' class='dbmng_form_button_left col-md-4 col-xs-12 '></div><div id='dbmng_button_center' class='col-md-4 col-xs-12 '></div><div id='dbmng_button_right' class='dbmng_form_button_right col-md-4 col-xs-12 '></div></div>",t="<div id='dbmng_buttons_row' class='row' style='margin-top: 0px;margin-bottom: 0px;'><div class='dbmng_form_button_message col-md-12'></div>   <div id='dbmng_button_left' class='dbmng_form_button_left col-md-4 col-xs-12 '></div><div id='dbmng_button_center' class='col-md-4 col-xs-12 '></div><div id='dbmng_button_right' class='dbmng_form_button_right col-md-4 col-xs-12 '></div></div>",i="last","first"==(i=s.aParam.ui.btn_insert.position?s.aParam.ui.btn_insert.position:i)?jQuery(r).prepend(t):"both"==i?(jQuery(r).append(e),jQuery(r).prepend(t)):jQuery(r).append(e),jQuery(r).find(".dbmng_form_button_left").append(a)),"function"==typeof s.table_ready&&s.table_ready(s.form)},isAllowed:function(e,t){return"function"!=typeof this.aParam.user_function.custom_user_function||this.aParam.user_function.custom_user_function(e,t)},deleteRecord:function(t,e){var a=this;this.api.delete({key:e,success:function(e){e.ok?("function"==typeof a.crud_success&&a.crud_success("delete",e),a.createTable({div_id:t})):"function"==typeof a.crud_delete?a.crud_delete("delete",e):(e=a.theme.alertMessage(e.message),jQuery(t).find(".dbmng_form_button_message").html(e),window.scrollTo(0,document.body.scrollHeight))},error:function(){var e=a.theme.alertMessage("Connection error");jQuery(t).find(".dbmng_form_button_message").html(e)}})},createInsertForm:function(e){return this.createForm(e)},createForm:function(i,n,e){var a,r=this,s=void 0===n?"insert":"update",e=("update"===s?a=r.getARecord(n,e):(a={},this.aParam.search&&jQuery.each(this.aParam.search,function(e,t){a[e]=t})),jQuery(i).html(this.form.createForm(a,r.aParam.template_form)),"function"==typeof r.form_ready&&r.form_ready(s,this.form),r.aParam.ui.btn_save.label),t=r.aParam.ui.btn_save,d="Cancel",l={},e=(r.aParam.ui.btn_cancel&&(d=r.aParam.ui.btn_cancel.label,l=r.aParam.ui.btn_cancel),r.theme.getButton(e,t)),t=(jQuery(e).click(function(){var e=r.form.isValid(),a=r.form.getValue(),t=(jQuery.each(r.aForm.fields,function(e,t){void 0!==t.skip_in_form&&t.skip_in_form&&delete a[e]}),!0);!1===(t="function"==typeof r.form_validation?r.form_validation():t).ok?(t=r.theme.alertMessage(t.msg),jQuery("#"+r.div_id).find(".dbmng_form_button_message").html(t)):!1===e.ok?jQuery(i).find(".dbmng_form_button_message").html(e.message):"update"==s?r.api.update({key:n,data:a,success:function(e){e.ok?("function"==typeof r.crud_success&&r.crud_success("update",e),jQuery(i).html(""),r.createTable({div_id:i})):"function"==typeof r.crud_update?r.crud_update("update",e):(e=r.theme.alertMessage(e.message),jQuery(i).find(".dbmng_form_button_message").html(e),window.scrollTo(0,document.body.scrollHeight))}}):r.api.insert({data:a,success:function(e){e.ok?("function"==typeof r.crud_success&&r.crud_success("insert",e),jQuery(i).html(""),r.createTable({div_id:i})):"function"==typeof r.crud_insert?r.crud_insert("insert",e):(e=r.theme.alertMessage(e.message),jQuery(i).find(".dbmng_form_button_message").html(e),window.scrollTo(0,document.body.scrollHeight))}})}),r.theme.getButton(d,l));jQuery(t).click(function(){jQuery(i).html(""),r.createTable({div_id:i})}),jQuery(i).append("<div id='dbmng_buttons_row' class='row' style='margin-top: 20px;margin-bottom: 100px;'><div class='dbmng_form_button_message col-md-12'></div><div class='dbmng_form_button_left col-md-4 col-xs-12 '></div><div class='col-md-4 col-xs-12 '></div><div class='dbmng_form_button_right col-md-4 col-xs-12 '></div></div>"),jQuery(i).find(".dbmng_form_button_left").append(t),jQuery(i).find(".dbmng_form_button_right").append(e)},getARecord:function(e,t){for(var a=null,i=0;i<t.length;i++)if(t[i][this.pk]==e){a=t[i];break}return a},createFormInline:function(t,e,a){for(var i=this,a=this.getARecord(e,a),n=(jQuery("button").attr("disabled","true"),t+" table #dbmng_row_id_"+e),r=[],s=(jQuery(n+" td").each(function(){r.push(jQuery(this).width())}),jQuery(n)[0]);s.firstChild;)s.removeChild(s.firstChild);var d,l,o=this.form.getFields(a);for(d in o)this.form.getWidget(d).isVisible()&&((l=document.createElement("td")).className="dbmng_cell_inline",l.appendChild(o[d]),s.appendChild(l));jQuery(n).find("label").hide(),jQuery(n+" td.dbmng_cell_inline").each(function(e,t){jQuery(t).width(r[e]),i.theme instanceof p.BootstrapTheme||(jQuery(t).find("input").width(r[e]),jQuery(t).find("select").width(r[e]))}),"function"==typeof i.form_ready&&i.form_ready("update_inline",this.form);var a=i.aParam.ui.btn_save.label,u=i.aParam.ui.btn_save,a=i.theme.getButton(a,u);jQuery(a).click(function(){i.api.update({key:e,data:i.form.getValue(),success:function(e){"function"==typeof i.crud_success&&i.crud_success("update",e),jQuery("button").removeAttr("disabled"),jQuery(t).html(""),i.createTable({div_id:t})}})}),jQuery(n).append("<td class='dbmng_buttons'></td>"),jQuery(n+" td.dbmng_buttons").html(a)}}),p.CrudForm=e.extend({init:function(t){var a,i=this,e=(this.ready=!0,this.div_id=t.div_id,this.aParam=jQuery.extend(!0,{},p.defaults.aParam,t.aParam),this.form_ready=t.form_ready,this.crud_success=t.crud_success,this.form_validation=t.form_validation,t.theme?this.theme=t.theme:this.theme=p.defaults.theme,t.url?this.url=t.url:this.url="?","/"!=this.url.slice(-1)&&(this.url=this.url+"/"),this.aParam.url=this.url,{url:i.url,user:t.user,password:t.password});void 0!==this.offline&&(e.offline=this.offline),i.api=new p.Api(e),t.aForm?(this.aForm=t.aForm,this.form=new p.Form({aForm:this.aForm,aParam:this.aParam,theme:this.theme}),this.pk=this.form.getPkField(),"function"==typeof t.success&&t.success(this)):(this.ready=!1,e={},t.user&&(e={Authorization:"Basic "+btoa(t.user+":"+t.password)}),a="?",this.aParam.search&&jQuery.each(this.aParam.search,function(e,t){a+="&"+e+"="+t}),jQuery.ajax({url:this.url+"schema"+a,dataType:"json",headers:e,success:function(e){i.aForm=e,i.ready=!0,i.form=new p.Form({aForm:i.aForm,aParam:i.aParam,theme:i.theme}),i.pk=i.form.getPkField(),"function"==typeof t.success&&t.success(i)},error:function(e){"function"==typeof t.error&&t.error(e)}}))},createForm:function(t){var a,i,n;this.ready&&(a=void 0===t?"insert":"update",n=(i=this).aForm.primary_key[0],"update"==a?this.api.select({search:n+"="+t,success:function(e){i.generateForm(a,n,t,e)}}):"insert"==a&&i.generateForm(a,n))},generateForm:function(i,n,r,e){var a,s=this,e=(jQuery("#"+s.div_id).html(""),void 0!==e?jQuery("#"+s.div_id).append(s.form.createForm(e.data[0],s.aParam.template_form)):(a={},this.aParam.search&&jQuery.each(this.aParam.search,function(e,t){a[e]=t}),jQuery("#"+s.div_id).append(s.form.createForm(a,s.aParam.template_form))),s.aParam.ui.btn_save.label),t=s.aParam.ui.btn_save,d="Cancel",l={},e=(s.aParam.ui.btn_cancel&&(d=s.aParam.ui.btn_cancel.label,l=s.aParam.ui.btn_cancel),s.theme.getButton(e,t)),t=(jQuery(e).click(function(){var t,e=s.form.isValid(),a=!0;!1===(a="function"==typeof s.form_validation?s.form_validation():a).ok?(t=s.theme.alertMessage(a.msg),jQuery("#"+s.div_id).find(".dbmng_form_button_message").html(t)):!1===e.ok?jQuery("#"+s.div_id).find(".dbmng_form_button_message").html(e.message):"update"==i?s.api.update({key:n,data:s.form.getValue(),success:function(e){e.ok?("function"==typeof s.crud_success&&s.crud_success("update",e),s.createForm(r)):(t=s.theme.alertMessage(e.message),jQuery("#"+s.div_id).find(".dbmng_form_button_message").html(t))}}):"insert"==i&&s.api.insert({data:s.form.getValue(),success:function(e){"function"==typeof s.crud_success&&s.crud_success("insert",e),jQuery(s.div_id).html(""),s.createForm(e.inserted_id)}})}),s.theme.getButton(d,l));jQuery(t).click(function(){"function"==typeof s.crud_success&&s.crud_success("cancel"),jQuery(s.div_id).html("")}),jQuery("#"+s.div_id).append("<div id='dbmng_buttons_row' class='row' style='margin-top: 20px;margin-bottom: 100px;'><div class='dbmng_form_button_message col-xs-12'></div><div class='dbmng_form_button_left col-xs-4'></div><div class='col-xs-4'></div><div class='dbmng_form_button_right col-xs-4'></div></div>"),jQuery("#"+s.div_id).find(".dbmng_form_button_left").append(t),jQuery("#"+s.div_id).find(".dbmng_form_button_right").append(e),"function"==typeof s.form_ready&&s.form_ready(i,this.form)}}),p.CrudInline=p.Crud.extend({generateTable:function(e,t){var e=e.div_id,a=("#"!=e.substring(0,1)&&(e="#"+e),this),i=jQuery.extend(!0,{},this.aParam);i.hide_label=!0,i.hide_placeholder=!0;i=new p.FormInline({aForm:this.aForm,aParam:i,onChange:function(){var t=this,e={};e[t.field]=t.getValue(),a.api.update({key:t.pk_value,data:e,success:function(e){t.setErrorState(e.ok,e.message)},error:function(e){jQuery(jQuery(t.widget).parents("td")[0]).removeClass("success").addClass("danger")}})},onChangeRow:function(){}}).createForm(t.data);jQuery(e).append(i)}}),p.AbstractTheme=e.extend({test:function(e){return e+2},getFieldContainer:function(e){var t=document.createElement("div");return t.className="dbmng_form_row",t.className=t.className+" dbmng_form_field_"+e.field,t},getLabel:function(e){var t=document.createElement("div"),a=(t.className="dbmng_form_label",document.createElement("label")),i=(a.setAttribute("for","dbmng_"+e.field),e.label),n=(e.label_long&&(i=e.label_long),document.createElement("div")),i=(n.innerHTML="<span>"+i+"</span>",n.firstChild);return a.appendChild(i),0===parseInt(e.nullable)&&((n=document.createElement("span")).className="dbmng_required",i=document.createTextNode("*"),n.appendChild(i),a.appendChild(n)),t.appendChild(a),t},getInput:function(e){var t=document.createElement("input");return this.assignAttributes(t,e),void 0!==e.value&&(t.value=e.value),e.placeholder?t.placeholder=e.placeholder:t.type="text",e.field_type&&(t.type=e.field_type),t},getCheckbox:function(e){var t=document.createElement("input");return e.exclude_attribute||this.assignAttributes(t,e),t.type="checkbox",void 0!==e.value&&(t.value=e.value),e.checked&&(t.checked=!0),e.placeholder&&(t.placeholder=e.label),t},getSelect:function(a){var i,n=document.createElement("select");return this.assignAttributes(n,a),a.voc_val&&(i=document.createElement("option"),a.placeholder&&(i.text=a.label,i.disabled="disabled"),n.options.add(i),jQuery.each(a.voc_val,function(e,t){"string"!=typeof t&&jQuery.each(t,function(e,t){(i=document.createElement("option")).value=e,i.text=t,void 0!==a.value&&a.value==e&&(i.selected=!0)}),n.options.add(i)})),n},getRadio:function(n){var r,a=document.createElement("div"),s=n.field,d=document.createElement("div");return n.voc_val&&jQuery.each(n.voc_val,function(e,t){"string"!=typeof t&&jQuery.each(t,function(e,t){(r=document.createElement("input")).type="radio",r.name=s,r.id=s+"_"+e,r.value=e;var a=document.createElement("label"),i=(a.setAttribute("for",s+"_"+e),document.createElement("div")),t=(i.innerHTML="<span>"+t+"</span>",i.firstChild);a.appendChild(t),void 0!==n.value&&n.value==e&&(r.checked=!0),d.appendChild(r),d.appendChild(a)}),a.appendChild(d)}),a},getSelectNM:function(e){var t,a,i="select";if("select"==(i="checkbox"==e.out_type?"checkbox":i)){if((t=document.createElement("select")).multiple=!0,this.assignAttributes(t,e),e.voc_val)for(a in n=document.createElement("option"),e.placeholder&&(n.text=e.label,n.disabled="disabled"),t.options.add(n),e.voc_val)(n=document.createElement("option")).value=a,n.text=e.voc_val[a],e.value&&("number"==typeof e.value[0]&&(a=parseInt(a)),-1<e.value.indexOf(a)&&(n.selected=!0)),t.options.add(n)}else if("checkbox"==i)for(a in t=document.createElement("ul"),this.addClass(t,"dbmng_checkbox_ul"),this.assignAttributes(t,e),e.voc_val){var n,r=document.createElement("li"),s=((n=new p.CheckboxWidget({field:e.field,aField:{type:"int",widget:"checkbox",theme:this}})).createField(a),r.appendChild(n.widget),document.createTextNode(e.voc_val[a]));r.appendChild(s),t.appendChild(r)}return t},assignAttributes:function(e,t){t.field&&(e.name=t.field),!1===t.nullable&&(e.required=!0),1==t.readonly&&(e.disabled="disabled"),t.classes&&this.addClass(e,t.classes)},addClass:function(e,t){var a="";e.className?0<e.className.length&&(a=" "):e.className="",e.className=e.className+a+t},addTitle:function(e,t){e.title=t},getForm:function(e){return document.createElement("form")},getTextarea:function(e){var t=document.createElement("textarea");return this.assignAttributes(t,e),e.value&&(t.value=e.value),e.placeholder&&(t.placeholder=e.placeholder),t},getTable:function(e){var t=document.createElement("div"),a=document.createElement("table");if(e.aParam&&e.aParam.ui&&e.aParam.ui.table_class&&this.addClass(a,e.aParam.ui.table_class),e.rawData||(e.rawData=e.data),e.data){a.appendChild(this.getTableHeader(e));for(var i=document.createElement("tbody"),n=0;n<e.data.length;n++){var r,s=this.getTableRow({data:e.data[n],rawData:e.rawData[n],options:e.options});e.options&&(e.options.assignClass&&this.addClass(s,"dbmng_row dbmng_row_"+n),"function"==typeof e.options.addColumn&&null!==(r=e.options.addColumn({data:e.data[n],rawData:e.rawData[n],options:e.options}))&&s.appendChild(r)),i.appendChild(s)}a.appendChild(i)}return t.appendChild(a),t},getTableHeader:function(e){var t=document.createElement("thead"),a=document.createElement("tr"),i=[],n=0;if(e.data&&0<e.data.length)for(var r in e.data[0])i[n]=r,n++;e.header||(e.header=i);for(var s=0;s<e.header.length;s++){var d=this.getTableHCell({content:e.header[s],options:e.options});e.options&&e.options.assignClass&&this.addClass(d,"dbmng_cell dbmng_head dbmng_col_"+i[s]),a.appendChild(d)}return t.appendChild(a),t},getTableRow:function(e){var t=document.createElement("tr");if(e.data)for(var a in e.data){var i=this.getTableCell({content:e.data[a],options:e.options});e.options&&(e.options.assignClass&&this.addClass(i,"dbmng_cell dbmng_col_"+a),"function"==typeof e.options.setIDRow&&(t.id=e.options.setIDRow(e.rawData))),t.appendChild(i)}return t},getTableHCell:function(e){e=e||{};var t=document.createElement("th");return e.content&&t.appendChild(document.createTextNode(e.content)),t},getTableCell:function(t){t=t||{};var a=document.createElement("td");if(void 0!==t.content&&null!==t.content)if("object"==typeof t.content)a.appendChild(t.content);else if((""+t.content).startsWith("<"))try{a.appendChild(jQuery(t.content)[0])}catch(e){a.appendChild(document.createTextNode(t.content))}else a.appendChild(document.createTextNode(t.content));return a},getButton:function(e,t){var a,i="button",i=((t=t||{}).type&&(i=t.type),document.createElement(i));return t.class&&this.addClass(i,t.class),t.icon?(a=document.createElement("i"),this.addClass(a,t.icon),this.addTitle(a,e),i.appendChild(a),t.label_file&&((a=document.createElement("span")).appendChild(document.createTextNode(" "+t.label_file)),i.appendChild(a))):i.appendChild(document.createTextNode(e)),i},alertMessage:function(e){var t=document.createElement("div");return this.addClass(t,"dbmng_alert"),t.appendChild(document.createTextNode(e)),t},createFileUploadField:function(e,t,a){var i=document.createElement("div"),n=(this.addClass(i,"dbmng_fileupload_meta_container"),document.createElement("div")),n=(this.addClass(n,"dbmng_fileupload_container"),i.appendChild(n),i.appendChild(document.createElement("br")),document.createElement("div")),e=(this.addClass(n,"dbmng_fileupload_button_progress"),i.style.cssText="width:100%; float:left;",n.appendChild(this.createFormUpload(e,t,a)),this.createProgressBar({class:"progress",width:"69"}));return n.appendChild(e),i.appendChild(n),i},createFormUpload:function(e,t,a){(a=a||{}).class||(a.class=""),a.type="a";t=this.getButton(t,a);return this.addClass(t,"fileinput-button"),t.style.cssText="float:left; width:30%",t.appendChild(e),t},createProgressBar:function(e){(e=e||{}).class||(e.class=""),e.width||(e.width=100);var t=document.createElement("div"),e=(this.addClass(t,e.class),t.style.cssText="width:"+e.width+"%; border:1px solid #CCC; height:20px; float:left;",document.createElement("div"));return this.addClass(e,"progress-bar progress-bar-success"),e.style.cssText="background-color:#CCC; height:20px; width:0px;",t.appendChild(e),t},getDeleteButton:function(e){return this.getButton("X",{type:"span"})},setErrorState:function(e,t,a){e=jQuery(jQuery(e.widget).parents(".dbmng_form_row")[0]);e.find("span.error_message").remove(),t?e.removeClass("alert-danger").addClass("alert-success"):(e.append('<span class="error_message">'+a+"</span>"),e.removeClass("alert-success").addClass("alert-danger"))}}),p.AppTheme=p.AbstractTheme.extend({getLabel:function(e){e=this._super(e);return jQuery(jQuery(e)[0]).find("label").addClass("label-form"),jQuery(e).css("font-weight","bold"),e},assignAttributes:function(e,t){this._super(e,t),this.addClass(e,"input-form")},alertMessage:function(e){e=this._super(e);return this.addClass(e,"alert alert-block alert-danger"),e},getTable:function(e){e=this._super(e);return this.addClass(e.firstChild,"table"),e},getButton:function(e,t){e=this._super(e,t);return this.addClass(e,"btn btn-default"),e},createFileUploadField:function(e,t,a){e=this._super(e,t,a),t=jQuery(e).find(".fileinput-button"),t.css("width",""),t.addClass("col-xs-6"),a=jQuery(e).find(".progress");return a.css("width",""),a[0].style.cssText="",a.wrap('<div class="col-xs-6" style="padding-top: 7px;"></div>'),a.find(".progress-bar")[0].style.cssText="",e},getDeleteButton:function(e,t){var a=document.createElement("i");return this.addClass(a,t),this.addTitle(a,e),a}}),p.BootstrapItaliaTheme=p.AbstractTheme.extend({getFieldContainer:function(e){var t=document.createElement("div");return t.className="dbmng_form_row","checkbox"!==e.widget&&"select"!==e.widget&&(t.className="form-group dbmng_bi_field"),"select"!=e.widget&&"select_nm"!=e.widget||(t.className="bootstrap-select-wrapper"),t.className=t.className+" dbmng_form_field_"+e.field,t},getLabel:function(e){var t,a=document.createDocumentFragment();return"checkbox"!==e.widget&&((a=document.createElement("label")).className="active",a.setAttribute("for","dbmng_"+e.field),t=e.label,e.label_long&&(t=e.label_long),a.innerHTML=t,0===parseInt(e.nullable)&&((t=document.createElement("span")).className="dbmng_required",e=document.createTextNode("*"),t.appendChild(e))),a},getInput:function(e){var t=document.createElement("input");return t.className="form-control","varchar"==e.type||"text"==e.type?t.setAttribute("type","text"):"date"==e.type&&t.setAttribute("type","date"),void 0!==e.value&&(t.value=e.value),e.placeholder?t.placeholder=e.placeholder:t.type="text",e.field_type&&(t.type=e.field_type),t},getCheckbox:function(e){var t=document.createElement("div"),a=document.createElement("div"),i=(a.className="form-check",t.appendChild(a),document.createElement("input")),n=(i.className="real_widget",a.appendChild(i),document.createElement("label")),a=(a.appendChild(n),e.label);return e.label_long&&(a=e.label_long),n.innerHTML=a,i.setAttribute("id","dbmng_"+e.field),n.setAttribute("for","dbmng_"+e.field),e.exclude_attribute||this.assignAttributes(i,e),i.type="checkbox",void 0!==e.value&&(i.value=e.value),e.checked&&(i.checked=!0),e.placeholder&&(i.placeholder=e.label),t},getSelect:function(a){var i,e,t,n=document.createElement("div"),r=(a.addButton&&(n.className="input-group"),document.createElement("select"));return r.className="form-control aepy-select real_widget",this.assignAttributes(r,a),a.searchable&&r.setAttribute("data-live-search",a.searchable),a.searchable_placeholder&&r.setAttribute("data-live-search-placeholder",a.searchable_placeholder),a.voc_val&&(i=document.createElement("option"),a.placeholder&&(i.text=a.label,i.disabled="disabled"),r.options.add(i),jQuery.each(a.voc_val,function(e,t){"string"!=typeof t&&jQuery.each(t,function(e,t){(i=document.createElement("option")).value=e,i.text=t,void 0!==a.value&&a.value==e&&(i.selected=!0)}),r.options.add(i)})),n.appendChild(r),a.addButton&&((e=document.createElement("div")).className="input-group-append",t='<button style="background-color:#06c;" class="'+a.addButtonClass+' btn btn-primary btn-icon"><svg class="icon icon-white"><use xlink:href="/bootstrap-italia/dist/svg/sprite.svg#it-plus"></use></svg></button>',t=jQuery(t)[0],e.appendChild(t),n.appendChild(e)),n},setErrorState:function(e,t,a){e=jQuery(e.widget);e.parent().find(".invalid-feedback").remove(),t?e.removeClass("is-invalid").addClass("is-valid"):(e.parent().append('<div class="invalid-feedback">'+a+"</div>"),e.removeClass("is-valid").addClass("is-invalid"))},createFileUploadField:function(e,t,a){e=this._super(e,t,a),t=jQuery(e).find(".fileinput-button"),t.css("width",""),t.addClass("col-xs-6"),a=jQuery(e).find(".progress");return a.css("width",""),a[0].style.cssText="",a.wrap('<div class="col-xs-6" style="padding-top: 7px;"></div>'),a.find(".progress-bar")[0].style.cssText="",e}}),p.BootstrapTheme=p.AbstractTheme.extend({getLabel:function(e){e=this._super(e);return jQuery(e).css("font-weight","bold"),e},assignAttributes:function(e,t){this._super(e,t),this.addClass(e,"form-control")},alertMessage:function(e){e=this._super(e);return this.addClass(e,"alert alert-block alert-danger"),e},getTable:function(e){e=this._super(e);return this.addClass(e.firstChild,"table"),e},getButton:function(e,t){e=this._super(e,t);return this.addClass(e,"btn btn-default"),e},createFileUploadField:function(e,t,a){e=this._super(e,t,a),t=jQuery(e).find(".fileinput-button"),t.css("width",""),t.addClass("col-xs-6"),a=jQuery(e).find(".progress");return a.css("width",""),a[0].style.cssText="",a.wrap('<div class="col-xs-6" style="padding-top: 7px;"></div>'),a.find(".progress-bar")[0].style.cssText="",e},getDeleteButton:function(e,t){var a=document.createElement("i");return this.addClass(a,t),this.addTitle(a,e),a}}),p.Framework7Theme=p.AbstractTheme.extend({getForm:function(e){var t=document.createElement("form"),a=(this.addClass(t,"list"),document.createElement("ul"));return t.appendChild(a),t},getFieldContainer:function(e){var t=document.createElement("li"),a=document.createElement("div"),e=(a.className="item-content item-input ",a.className=a.className+" dbmng_form_field_"+e.field,t.appendChild(a),document.createElement("div"));return e.className="item-inner",a.appendChild(e),t},getLabel:function(e){var t=document.createElement("div"),a=(t.className="item-title item-label",e.label);return e.label_long&&(a=e.label_long),t.innerHTML=a,t},getInput:function(e){var t=document.createElement("div"),a=(t.className="item-input-wrap",document.createElement("input"));return t.appendChild(a),this.assignAttributes(a,e),void 0!==e.value&&(a.value=e.value),e.placeholder&&(a.placeholder=e.placeholder),a.type="text",e.field_type&&(a.type=e.field_type),t},getCheckbox:function(e){var t=document.createElement("div"),a=(t.className="item-after",document.createElement("label")),i=(a.className="toggle toggle-init color-green",t.appendChild(a),document.createElement("input")),n=(a.appendChild(i),document.createElement("i"));return n.className="toggle-icon",a.appendChild(n),e.exclude_attribute||this.assignAttributes(i,e),i.type="checkbox",void 0!==e.value&&(i.value=e.value),e.checked&&(i.checked=!0),e.placeholder&&(i.placeholder=e.label),t},getSelect:function(a){var e=document.createElement("div"),i=(e.className="item-input-wrap input-dropdown-wrap",document.createElement("select"));if(e.appendChild(i),this.assignAttributes(i,a),a.voc_val){var n=document.createElement("option");if(a.placeholder&&(n.text=a.label,n.disabled="disabled"),i.options.add(n),"[object Object]"===Object.prototype.toString.call(a.voc_val))for(var r in a.voc_val)(n=document.createElement("option")).value=r,n.text=a.voc_val[r],void 0!==a.value&&a.value==r&&(n.selected=!0),i.options.add(n);else"[object Array]"===Object.prototype.toString.call(a.voc_val)&&jQuery.each(a.voc_val,function(e,t){"string"!=typeof t?jQuery.each(t,function(e,t){(n=document.createElement("option")).value=e,n.text=t,void 0!==a.value&&a.value==e&&(n.selected=!0)}):((n=document.createElement("option")).value=r,n.text=a.voc_val[r],void 0!==a.value&&a.value==r&&(n.selected=!0)),i.options.add(n)})}return e},getSelectNM:function(e){var t,a,i="select";if("select"==(i="checkbox"==e.out_type?"checkbox":i)){(t=document.createElement("a")).className="item-link smart-select smart-select-init",t["data-open-in"]="popover";var n=document.createElement("select");if(n.multiple=!0,t.appendChild(n),this.assignAttributes(n,e),e.voc_val)for(a in r=document.createElement("option"),e.placeholder&&(r.text=e.label,r.disabled="disabled"),n.options.add(r),e.voc_val)(r=document.createElement("option")).value=a,r.text=e.voc_val[a],e.value&&("number"==typeof e.value[0]&&(a=parseInt(a)),-1<e.value.indexOf(a)&&(r.selected=!0)),n.options.add(r)}else if("checkbox"==i)for(a in t=document.createElement("ul"),this.addClass(t,"dbmng_checkbox_ul"),this.assignAttributes(t,e),e.voc_val){var r,s=document.createElement("li"),d=((r=new p.CheckboxWidget({field:e.field,aField:{type:"int",widget:"checkbox",theme:this}})).createField(a),s.appendChild(r.widget),document.createTextNode(e.voc_val[a]));s.appendChild(d),t.appendChild(s)}return t},assignAttributes:function(e,t){},alertMessage:function(e){e=this._super(e);return this.addClass(e,"alert alert-block alert-danger"),e},getTable:function(e){e=this._super(e);return this.addClass(e.firstChild,"data-table card"),e},getButton:function(e,t){e=this._super(e,t);return this.addClass(e,"button button-raised"),e},createFileUploadField:function(e,t,a){e=this._super(e,t,a),t=jQuery(e).find(".fileinput-button"),t.css("width",""),t.addClass("col-50"),a=jQuery(e).find(".progress");return a.css("width",""),a[0].style.cssText="",a.wrap('<div class="col-50" style="padding-top: 7px;"></div>'),a.find(".progress-bar")[0].style.cssText="",e},getDeleteButton:function(e,t){var a=document.createElement("i");return this.addClass(a,t),this.addTitle(a,e),a}}),p.AbstractWidget=e.extend({init:function(e){var i;(e=e||{}).field&&(this.field=e.field),e.aField&&(this.aField=e.aField),void 0!==this.aField.voc_val&&(i=[],"[object Array]"==Object.prototype.toString.call(this.aField.voc_val)?"[object String]"==Object.prototype.toString.call(this.aField.voc_val[0])&&(jQuery.each(this.aField.voc_val,function(e,t){var a={};a[e]=t,i.push(a)}),this.aField.voc_val=i):"[object Object]"==Object.prototype.toString.call(this.aField.voc_val)&&(jQuery.each(this.aField.voc_val,function(e,t){var a={};a[e]=t,i.push(a)}),this.aField.voc_val=i)),e.theme?this.theme=e.theme:this.theme=new p.AbstractTheme,e.aParam?this.aParam=e.aParam:this.aParam={},this.widget=null},createWidget:function(){return this.aField.value=this.getFieldValue(),this.theme.getInput(this.aField)},createField:function(e){var t=this,a=(this.aField.field=this.field,this.theme.getFieldContainer(this.aField)),i=a,n=((i=i.firstChild?i.firstChild:i).firstChild&&(i=i.firstChild),this.getLabel()),n=(null!==n&&i.appendChild(n),void 0!==e&&(this.value=e),this.createWidget()),e=n,r=jQuery(n).find(".real_widget");return 0<r.length&&(e=r[0]),(this.widget=e).onchange=function(e){t.onChange(e)},e.onfocus=function(e){t.onFocus(e)},i.appendChild(n),a},isVisible:function(){return!0},skipInTable:function(){return 1==this.aField.skip_in_tbl},getTextLabel:function(){return this.aField.label||this.field},getLabel:function(){var e,t=!1;return this.aParam.hide_label&&!0===this.aParam.hide_label&&(e=(e=t=!0)!==this.aParam.hide_placeholder&&e)&&(this.aField.placeholder=this.aField.label),t?null:this.theme.getLabel(this.aField)},onChange:function(e){this.isValid()},onFocus:function(e){},setValue:function(e){var t=0;return this.widget&&(this.widget.value=e,t=1),t},getValue:function(){return this.widget?this.widget.value:null},getDefaultValue:function(e){return""},getFieldValue:function(){var e=void 0!==this.value?this.value:this.aField.default||this.getDefaultValue();return e},convert2html:function(e){return e},setErrorState:function(e,t){this.theme.setErrorState(this,e,t)},isValidCustom:function(){return{ok:!0}},isValid:function(){var e,t=!1,a=0,i=(void 0!==this.aField.nullable&&(a=parseInt(this.aField.nullable)),!0),n="",r=(this.toValidate(a)&&(t=!0,null!==this.getValue()&&""!==this.getValue()||(i=!1,n="Empty Field ["+this.aField.field+"]")),void 0!==this.aField.validator&&(t=!0,"object"==typeof this.aField.validator?((a=this.aField.validator.regexp)instanceof RegExp?r=a:"string"==typeof a&&("/"==(a=0===a.indexOf("/")?a.substr(1,a.length):a).slice(-1)&&(a=a.substring(0,a.length-1)),a=new RegExp(a,"")),r=a,e=this.aField.validator.message):"email"==this.aField.validator?(r=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,e="You need to enter a valid email"):"url"==this.aField.validator?(r=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)/,e="You need to enter a valid URL"):"ip"==this.aField.validator&&(r=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/,e="You need to enter a valid IP address"),(a=r.test(this.getValue()))||(i=a,n=e)),this.isValidCustom());return r.ok||(i=!r.ok,n+=" "+r.message),t&&this.setErrorState(i,n),{ok:i,message:n}},toValidate:function(e){return 0===e&&"hidden"!=this.aField.field_type&&1!=this.aField.key&&void 0===this.aField.skip_in_form}}),p.AutocompleteWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="hidden",this.theme.getInput(this.aField)},createField:function(e){var a,t,i=this,n=this._super(e),r={},s=(r.field=this.aField.field+"_view",r.classes="typeahead",this.theme.getInput(r));return n.appendChild(s),"undefined"!=typeof Bloodhound?(r=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace("<b>"+e[1]+"</b>: "+e[3])},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:i.aField.url,wildcard:"%QUERY",transform:function(e){var a=[];return jQuery.each(e.data,function(e,t){a.push(t)}),a}}}),""!==e&&void 0!==e&&""!==e&&r.search(e,function(e){i.autocomplete_get(e,s)},function(e){i.autocomplete_get(e,s)}),a="key",i.aField.autocomplete_key&&(a=i.aField.autocomplete_key),e="label",i.aField.autocomplete_fieldname&&(e=i.aField.autocomplete_fieldname),t="Not found ",i.aField.not_found&&(t=i.aField.not_found),jQuery(s).typeahead({hint:!0,highlight:!0,minLength:0},{name:i.aField.autocomplete_fieldname,source:r,limit:100,display:i.aField.autocomplete_fieldname,templates:{header:"",notFound:function(e){return t+" <b>"+e.query+"<b>"},suggestion:Handlebars.compile("<div>{{"+e+"}}</div>")}}),jQuery(s).bind("typeahead:select",function(e,t){i.widget.value=t[a]})):n.appendChild(jQuery("<div class='alert alert-danger'><strong>DBMNG2 Error!</strong><p>Bloodhound library is not loaded</p></div>")[0]),n},autocomplete_get:function(e,t){0<e.length&&(e=e[0][this.aField.autocomplete_fieldname],t.value=e)}}),p.CheckboxWidget=p.AbstractWidget.extend({createWidget:function(){this.aField.value=this.getFieldValue();var e=!1;return 1==this.aField.value&&(e=!0),this.aField.checked=e,this.theme.getCheckbox(this.aField)},getValue:function(){var e="int"==this.aField.type?this.widget.checked?1:0:this.widget.checked;return e},convert2html:function(e){return this.aField.voc_val?this.aField.voc_val[e]:e}}),p.DateWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),void 0!==jQuery.datepicker?this.aField.field_type="hidden":"date"==this.aField.type?this.aField.field_type="date":"time"==this.aField.type?this.aField.field_type="time":"datetime-local"==this.aField.type&&(this.aField.field_type="datetime-local"),this.theme.getInput(this.aField)},createField:function(e){var t,a,i=this,n="dd-mm-yy",r=(i.aField.date_format_view&&(n=i.aField.date_format_view),this._super(e));return void 0!==jQuery.datepicker&&((t={}).field=this.aField.field+"_view",a=this.theme.getInput(t),void 0!==e&&""!==e&&null!==e&&(a.value=jQuery.datepicker.formatDate(n,jQuery.datepicker.parseDate("yy-mm-dd",e))),jQuery(a).blur(function(){""===jQuery(a).val()&&(i.widget.value="")}),jQuery(a).datepicker({altField:jQuery(i.widget),dateFormat:n,altFormat:"yy-mm-dd"}),r.appendChild(a)),r},getValue:function(){var e=this._super();return""===e?null:e}}),p.FileWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),void 0!==jQuery().fileupload?this.aField.field_type="hidden":this.aField.field_type="file",this.theme.getInput(this.aField)},getValue:function(){var e=this._super();return this.aField.multiple?this.files:e},createField:function(e){var t,a,i,n,r,s,d,l,o=this,u="server/php/",c=(o.aParam.url&&(u=o.aParam.url+"file/"+o.field+"/"),(u=o.aField.url?o.aField.url:u)+"files/"),h=(o.aField.weburl_file&&(c=o.aField.weburl_file),this._super(e));return void 0!==jQuery().fileupload?((t={}).field=this.aField.field+"_file",(t=this.theme.getInput(t)).type="file",t.name="files[]",o.aField.multiple&&(t.multiple="multiple"),i="btn btn-success",n="glyphicon glyphicon-plus",r="Select file...",s="Uploading...",o.aField.class&&(i=o.aField.class),o.aField.add_icon&&(n=o.aField.add_icon),o.aField.label_file&&(r=o.aField.label_file),o.aField.uploading_text&&(s=o.aField.uploading_text),(a={}).class=i,a.icon=n,a.label_file=r,h.appendChild(this.theme.createFileUploadField(t,r,a)),d=jQuery(h).find(".dbmng_fileupload_container"),l=jQuery(h).find(".progress"),void 0!==e&&""!==e&&null!==e&&(o.aField.multiple?(o.files=e,jQuery.each(e,function(e,t){o.addFile(d,c,t)})):o.addFile(d,c,e)),jQuery(t).fileupload({url:u,dataType:"json",add:function(e,t){d.append(s),t.submit()},progressall:function(e,t){t=parseInt(t.loaded/t.total*100,10);jQuery(l).find(".progress-bar").css("width",t+"%")},fail:function(e,t){d.append(o.theme.alertMessage("Error"))},done:function(e,t){t.result.files?0<t.result.files.length?jQuery.each(t.result.files,function(e,t){var a;t.error?d.append(o.theme.alertMessage(t.error)):t.completed?(a=c,t.relative_folder&&(a=t.relative_folder),o.addFile(d,a,t.name),a="",o.aField.multiple?(o.files||(o.files=[]),a=t.name,t.relative_path&&(a=t.relative_path),o.files.push(a)):(a=t.name,t.relative_path&&(a=t.relative_path),o.setValue(a))):d.append(o.theme.alertMessage("Not Completed!!!!"))}):(d.html(""),jQuery.each(t.messages,function(e,t){d.append(o.theme.alertMessage(t))})):d.append(o.theme.alertMessage(t.result.message))}})):jQuery(h).append(o.theme.alertMessage("Resources missing! Please load the following files: jquery-ui.js, jquery.iframe-transport and jquery.fileupload")),h},addFile:function(e,t,a){var i=this,n="glyphicon glyphicon-remove",r=(i.aField.remove_icon&&(n=i.aField.remove_icon),"Delete"),s=(i.aField.remove_title_icon&&(r=i.aField.remove_title_icon),parseInt(32001212121*Math.random()).toString(16)),d="",d=i.aField.hide_link?this.assignFileTypeIcon(a)+" "+a:"<a target='_NEW'  class='dbmng_fileupload_filelink' href='"+t+a+"'>"+this.assignFileTypeIcon(a)+" "+a+"</a>&nbsp;",t=this.theme.getDeleteButton(r,n);e.append("<br/><span id='"+s+"'>"+d+"&nbsp</span>"),e.find("#"+s).append(t),jQuery(t).click(function(){var e;jQuery("#"+s).html(""),i.aField.multiple?-1<(e=i.files.indexOf(a))&&i.files.splice(e,1):i.setValue("")})},assignFileTypeIcon:function(e){var t="";return t="pdf"==e.split(".")[1]?'<i class="fa fa-file-pdf-o"></i>':t}}),p.HiddenWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="hidden",this.theme.getInput(this.aField)},getLabel:function(){return null},isVisible:function(){return!1}}),p.NumericWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="number",this.theme.getInput(this.aField)},getValue:function(){var e=this._super();return""===e?null:(e=+e,isNaN(e)?null:e)}}),p.PasswordWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="password",this.theme.getInput(this.aField)}}),p.RadioWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field=this.field,this.theme.getRadio(this.aField)},getValue:function(){return""!==jQuery("input[name='"+this.field+"']:checked").val()?"int"==this.aField.type?parseInt(jQuery("input[name='"+this.field+"']:checked").val()):jQuery("input[name='"+this.field+"']:checked").val():null},convert2html:function(a){var i;return jQuery.each(this.aField.voc_val,function(e,t){"string"!=typeof t?jQuery.each(t,function(e,t){e==a&&(i=t)}):i=t}),i}}),p.SelectNMWidget=p.AbstractWidget.extend({createWidget:function(){var n,r=this,e=(this.aField.value=this.getFieldValue(),this.aField.field=this.field,"select");if("select"==(e="checkbox"==r.aField.out_type?"checkbox":e)){if((o=document.createElement("select")).multiple=!0,r.theme.assignAttributes(o,r.aField),r.aField.voc_val){var t=document.createElement("option");for(n in r.aField.placeholder&&(t.text=r.aField.label,t.disabled="disabled"),o.options.add(t),r.aField.voc_val){var t=document.createElement("option"),a="",i="";if("object"==typeof r.aField.voc_val[0]){var s,d=r.aField.voc_val[n];for(s in d){a=d[i=s];break}}else i=n,a=r.aField.voc_val[n];t.value=i,t.text=a,r.aField.value&&("number"==typeof r.aField.value[0]&&(i=parseInt(i)),-1<r.aField.value.indexOf(i)&&(t.selected=!0)),o.options.add(t)}}}else if("checkbox"==e){var l,o=document.createElement("div"),u=document.createElement("ul");u.id="ul_"+r.aField.field;if(void 0!==r.aField.search_nm&&(e="",void 0!==r.aField.search_nm_placeholder&&(e=r.aField.search_nm_placeholder),l=document.createElement("input"),r.theme.addClass(l,"dbmng_search_nm"),r.theme.assignAttributes(l,r.aField),l.placeholder=e,l.onkeyup=function(e){var t=jQuery("#ul_"+r.aField.field+" li"),a=e.target.value.toLowerCase();1<a.length?jQuery.each(t,function(e,t){-1<jQuery(t).text().toLowerCase().search(a)?jQuery(t).show():jQuery(t).hide()}):jQuery(t).show()},o.appendChild(l)),r.theme.addClass(u,"dbmng_checkbox_ul"),"object"==typeof r.aField.voc_val[0])jQuery.each(r.aField.voc_val,function(e,t){jQuery.each(t,function(e,t){n=e;var a=document.createElement("li"),i=!1,e=(r.aField.value&&("number"==typeof r.aField.value[0]&&(n=parseInt(e)),-1<r.aField.value.indexOf(n)&&(i=!0)),t),t={checked:i,value:n,label:e,exclude_attribute:!0},i=(a.appendChild(r.theme.getCheckbox(t)),document.createTextNode(e));a.appendChild(i),u.appendChild(a)})});else for(n in r.aField.voc_val){var c=document.createElement("li"),h=!1,m=(r.aField.value&&("number"==typeof r.aField.value[0]&&(n=parseInt(n)),-1<r.aField.value.indexOf(n)&&(h=!0)),r.aField.voc_val[n]),h={checked:h,value:n,label:m,exclude_attribute:!0},h=(c.appendChild(this.theme.getCheckbox(h)),document.createTextNode(m));c.appendChild(h),u.appendChild(c)}o.appendChild(u)}return o},convert2html:function(e){var t=this,i="",n=!0;if(void 0!==e)return jQuery.each(e,function(e,a){n?n=!1:i+="<span class='dbmng_select_nm_sep'>,</span>&nbsp;","object"==typeof t.aField.voc_val[0]?jQuery.each(t.aField.voc_val,function(e,t){"object"==typeof t&&jQuery.each(t,function(e,t){e==a&&(i+="<span class='dbmng_select_nm_item'>"+t+"</span>")})}):i+="<span class='dbmng_select_nm_item'>"+t.aField.voc_val[a]+"</span>"}),jQuery("<div>"+i+"</div>")[0]},getValue:function(){var t,a,i=this,e="select";return"select"==(e="checkbox"==this.aField.out_type?"checkbox":e)?"int"==this.aField.type?(a=[].concat(jQuery(this.widget).val()),t=[],a.forEach(function(e){t.push(parseInt(e))})):t=jQuery(this.widget).val():"checkbox"==e&&(e=jQuery(this.widget).find("input[type=checkbox]"),a=[],e.each(function(e,t){t.checked&&("int"==i.aField.type?a.push(parseInt(t.value)):a.push(t.value))}),t=a),t}}),p.SelectWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field=this.field,this.theme.getSelect(this.aField)},getValue:function(){return""!==jQuery(this.widget).val()?"int"==this.aField.type?parseInt(jQuery(this.widget).val()):jQuery(this.widget).val():null},convert2html:function(a){var i;return jQuery.each(this.aField.voc_val,function(e,t){"string"!=typeof t?jQuery.each(t,function(e,t){e==a&&(i=t)}):i=t}),i}}),p.TextareaWidget=p.AbstractWidget.extend({createWidget:function(){return this.aField.value=this.getFieldValue(),this.aField.field_type="password",this.theme.getTextarea(this.aField)}}),p.defaults.theme=new p.AbstractTheme,p.defaults.aParam={ui:{btn_edit:{label:"Edit"},btn_edit_inline:{label:"Edit inline"},btn_delete:{label:"Delete"},btn_insert:{label:"Insert"},btn_save:{label:"Save"},btn_cancel:{label:"Cancel"}},user_function:{inline:0,upd:1,del:1,ins:1}},window.Dbmng=p}();